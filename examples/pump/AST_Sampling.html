<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fmdtools-AdaStress integration &mdash; fmdtools 2.0-beta-2 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/nbsphinx-code-cells.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/fmdtools_ico.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="fmdtools Paper Demonstration" href="../multirotor/Demonstration.html" />
    <link rel="prev" title="Stochastic Modelling in fmdtools" href="Stochastic_Modelling.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/logo_glow.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../README.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../README.html#contributions">Contributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#contributors">Contributors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../README.html#license-notices">License/Notices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#disclaimers">Disclaimers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/Development%20Guide.html">Development Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../docs/Development%20Guide.html#why-fmdtools">Why fmdtools?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#key-features">Key Features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../docs/Development%20Guide.html#intro-to-fmdtools">Intro to fmdtools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html">Intro to resilience modelling, simulation, and visualization in Python with fmdtools.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#author-daniel-hulse">Author: Daniel Hulse</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#version-2-0-beta-2">Version: 2.0-beta-2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#motivation-modelling-system-resilience">Motivation: Modelling System Resilience</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#why-is-resilience-important">Why is Resilience Important?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#enabling-proactive-design-process">Enabling proactive design process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#why-fmdtools-possible-competitors">Why fmdtools? Possible Competitors:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#why-fmdtools-pros">Why fmdtools? Pros:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#why-not-fmdtools-cons">Why <strong>not</strong> fmdtools? Cons:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#what-is-fmdtools-a-python-package-for-design-simulation-and-analysis-of-resilience">What is fmdtools? A Python package for <strong>design</strong>, <strong>simulation</strong>, and <strong>analysis</strong> of resilience.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#what-is-fmdtools-repo-structure">What is fmdtools? Repo Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#activity-download-and-install-fmdtools">Activity: Download and Install fmdtools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#analysis-workflow-structure">Analysis Workflow/Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#defining-a-model">Defining a Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#id1">Defining a Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#function-code-template">Function Code Template</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#model-code-template">Model Code Template</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#demo-model-activity-examples-pump-ex-pump-py">Demo Model Activity: examples/pump/ex_pump.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#more-resources-for-model-definition">More Resources for Model Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#notebook-activity">Notebook Activity:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#simulation-concepts-static-undirected-propagation">Simulation Concepts: Static/Undirected Propagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#simulation-concepts-propagation-over-time">Simulation Concepts: Propagation over Time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#simulation-concepts-types-of-simulations">Simulation Concepts: Types of Simulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#simulation-concepts-sampling-approaches">Simulation Concepts: Sampling Approaches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#simulation-concepts-things-to-consider">Simulation Concepts: Things to Consider</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#activity-simulate-the-model">Activity: Simulate the Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#analysis-modules">Analysis Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#analysis-activity">Analysis Activity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#conclusions-summary">Conclusions/Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Intro_to_fmdtools.html#further-reading-links">Further Reading/Links</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../docs/Development%20Guide.html#contributions">Contributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#repo-structure">Repo Structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../docs/Development%20Guide.html#remote-structure">Remote Structure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#development-process">Development Process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../docs/Development%20Guide.html#release-checklist">Release Checklist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../docs/Development%20Guide.html#upload-to-pypi">Upload to PyPI</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#roles">Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#style-formatting">Style/Formatting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#testing">Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#contributors">Contributors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../CONTRIBUTORS.html">CONTRIBUTORS</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../docs/Development%20Guide.html#model-development-best-practices">Model Development Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#pay-attention-to-and-document-the-fmdtools-version">Pay attention to and document the fmdtools version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#plan-your-model-to-avoid-technical-debt">Plan your model to avoid technical debt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#don-t-copy-inherit-and-functionalize">Don’t copy, inherit and functionalize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#document-your-code-sometimes-before-your-write-it">Document your code, sometimes <em>before</em> your write it</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#don-t-get-ahead-of-yourself-try-to-get-a-running-simulation-first">Don’t get ahead of yourself–try to get a running simulation first</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#preserve-your-prototype-setup-by-formalizing-it-as-a-test">Preserve your prototype setup by formalizing it as a test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#edit-your-code">Edit your code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#structuring-a-model">Structuring a model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#use-model-constructs-to-simplify-your-code">Use model constructs to simplify your code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#style-advice">Style advice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#see-also">See also</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../Examples.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../Examples.html#pump">Pump</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Tutorial_complete.html">fmdtools Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Tutorial_complete.html#1.)-Loading-the-environment-and-model">1.) Loading the environment and model</a></li>
<li class="toctree-l4"><a class="reference internal" href="Tutorial_complete.html#2.),-3.),-and-4.)-Simulate-and-visualize-the-results!">2.), 3.), and 4.) Simulate and visualize the results!</a></li>
<li class="toctree-l4"><a class="reference internal" href="Tutorial_complete.html#5.)-Saving-Work">5.) Saving Work</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Pump_Example_Notebook.html">Pump Example Notebook</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Pump_Example_Notebook.html#Initial-Model-Checks">Initial Model Checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="Pump_Example_Notebook.html#History">History</a></li>
<li class="toctree-l4"><a class="reference internal" href="Pump_Example_Notebook.html#Propagating-and-Viewing-Results-for-Individual-Faults">Propagating and Viewing Results for Individual Faults</a></li>
<li class="toctree-l4"><a class="reference internal" href="Pump_Example_Notebook.html#Visualization-of-resilience-metrics">Visualization of resilience metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="Pump_Example_Notebook.html#Running-a-List-of-Faults">Running a List of Faults</a></li>
<li class="toctree-l4"><a class="reference internal" href="Pump_Example_Notebook.html#Running-a-Fault-Sampling-Approach">Running a Fault Sampling Approach</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Parallelism_Tutorial.html">Using Parallel Computing in fmdtools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Parallelism_Tutorial.html#Model-Checks">Model Checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="Parallelism_Tutorial.html#Using-Parallelism-in-Simulation">Using Parallelism in Simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="Parallelism_Tutorial.html#Performance-Comparison">Performance Comparison</a></li>
<li class="toctree-l4"><a class="reference internal" href="Parallelism_Tutorial.html#Comparison:-Lower-Tracking-Time-Resolution">Comparison: Lower Tracking Time Resolution</a></li>
<li class="toctree-l4"><a class="reference internal" href="Parallelism_Tutorial.html#Comparison-Conclusions:">Comparison Conclusions:</a></li>
<li class="toctree-l4"><a class="reference internal" href="Parallelism_Tutorial.html#Further-Computational-Cost-Reduction-via-Profiling">Further Computational Cost Reduction via Profiling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Optimization.html">Optimization using the ProblemInterface class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Optimization.html#ProblemInterface-Setup">ProblemInterface Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="Optimization.html#Problem-interfaces">Problem interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="Optimization.html#Optimization:">Optimization:</a></li>
<li class="toctree-l4"><a class="reference internal" href="Optimization.html#Multi-scenario-Optimization">Multi-scenario Optimization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Stochastic_Modelling.html">Stochastic Modelling in fmdtools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Stochastic_Modelling.html#Model-Setup">Model Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="Stochastic_Modelling.html#Simulation-and-Analysis">Simulation and Analysis</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">fmdtools-AdaStress integration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Python-setup:">Python setup:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Running-AdaStress-Methods">Running AdaStress Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#MCTS">MCTS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Pump">Pump</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Simulator">Simulator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Examples.html#multirotor">Multirotor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../multirotor/Demonstration.html">fmdtools Paper Demonstration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Demonstration.html#Initial-Network-Model">Initial Network Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Demonstration.html#Setting-Node-Positions">Setting Node Positions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Demonstration.html#Static-Model">Static Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Demonstration.html#Dynamic-Model">Dynamic Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Demonstration.html#Hierarchical-Model">Hierarchical Model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../multirotor/Urban_Drone_Demo.html">Urban Drone Demo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Urban_Drone_Demo.html#Model-Overview">Model Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Urban_Drone_Demo.html#Nominal-Simulation">Nominal Simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Urban_Drone_Demo.html#Resilience-model">Resilience model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../multirotor/Multirotor_Optimization.html">Integrated Resilience Optimization Architectures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Multirotor_Optimization.html#Design-Model">Design Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Multirotor_Optimization.html#Operational-Model">Operational Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Multirotor_Optimization.html#Resilience-Model">Resilience Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../multirotor/Multirotor_Optimization.html#Combined-Simulation/Optimization">Combined Simulation/Optimization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Examples.html#tank">Tank</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tank/Tank_Analysis.html">Hold-up Tank Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tank/Tank_Analysis.html#Verifying-the-nominal-state:">Verifying the nominal state:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tank/Tank_Analysis.html#History">History</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tank/Tank_Analysis.html#What-happens-under-component-faults?">What happens under component faults?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tank/Tank_Analysis.html#What-about-human-induced-faults?">What about human-induced faults?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tank/Tank_Analysis.html#Evaluating-Joint-Component-Human-fault-modes">Evaluating Joint Component-Human fault modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tank/Tank_Analysis.html#Testing-different-reaction-times">Testing different reaction times</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tank/Tank_Optimization.html">Cooling Tank Model Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tank/Tank_Optimization.html#Simulation">Simulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tank/Tank_Optimization.html#Verifying-the-nominal-state:">Verifying the nominal state:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tank/Tank_Optimization.html#What-happens-under-component-faults?">What happens under component faults?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tank/Tank_Optimization.html#Full-set-of-modes">Full set of modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tank/Tank_Optimization.html#Defining-Optimization-Problem">Defining Optimization Problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tank/Tank_Optimization.html#Optimization">Optimization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Examples.html#eps">EPS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../eps/EPS_Example_Notebook.html">EPS Example Notebook</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Examples.html#action-sequence-graph">Action Sequence Graph</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../asg_demo/Action_Sequence_Graph.html">Action Sequence Graph Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../asg_demo/Action_Sequence_Graph.html#Function-level-Simulation">Function-level Simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../asg_demo/Action_Sequence_Graph.html#Model-Simulation">Model Simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../asg_demo/Action_Sequence_Graph.html#Fault-Simulation">Fault Simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Examples.html#rover">Rover</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rover/Rover_Setup_Notebook.html">Rover Model Explanation and Preliminaries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../rover/Rover_Setup_Notebook.html#Model-Setup">Model Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rover/Rover_Setup_Notebook.html#Model-simulation">Model simulation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../rover/HFAC_Analyses/HFAC_Analyses.html">More Human Failure Analyses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rover/HFAC_Analyses/IDETC_Human_Paper_Analysis.html">Human Failure Representation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../rover/HFAC_Analyses/IDETC_Human_Paper_Analysis.html#Testing-behavioral-simulation">Testing behavioral simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rover/HFAC_Analyses/IDETC_Human_Paper_Analysis.html#Testing-Faults">Testing Faults</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rover/HFAC_Analyses/IDETC_Human_Paper_Analysis.html#Examining-Performance-Shaping-Factors">Examining Performance Shaping Factors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../rover/degradation_modelling/Degradation_Modelling_Notebook.html">Degradation Modelling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../rover/degradation_modelling/Degradation_Modelling_Notebook.html#Drive-Degradation">Drive Degradation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rover/degradation_modelling/Degradation_Modelling_Notebook.html#Human-Degradation">Human Degradation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rover/degradation_modelling/Degradation_Modelling_Notebook.html#Combined-Degradation">Combined Degradation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../rover/fault_sampling/Rover_Mode_Notebook.html">Synthetic Mode Generation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../rover/fault_sampling/Rover_Mode_Notebook.html#Cluster-Analysis">Cluster Analysis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../rover/optimization/Search_Comparison.html">Faulty State-Space Search Method Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../rover/optimization/Search_Comparison.html#Performance-Comparison">Performance Comparison</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rover/optimization/Search_Comparison.html#Comparing-Solutions-over-weights---Fault-Space-Formulation">Comparing Solutions over weights - Fault-Space Formulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../rover/optimization/Search_Comparison.html#Comparing-Solutions-over-weights---Result-Space-Formulation">Comparing Solutions over weights - Result-Space Formulation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../rover/optimization/Rover_Response_Optimization.html">Rover Response Optimization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../rover/optimization/Rover_Response_Optimization.html#Optimization">Optimization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Examples.html#multiflow-demo">Multiflow Demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../multiflow_demo/Multiflow_and_Commsflow_Demonstration.html">Demonstration on Using MultiFlow and CommsFlow</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/Glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/fmdtools.html">Module Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../docs/fmdtools.define.html">fmdtools.define package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#fmdtools-define-block">fmdtools.define.block</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.common">fmdtools.define.common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.flow">fmdtools.define.flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.mode">fmdtools.define.mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#fmdtools-define-model">fmdtools.define.model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.parameter">fmdtools.define.parameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.rand">fmdtools.define.rand</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.state">fmdtools.define.state</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.time">fmdtools.define.time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.geom">fmdtools.define.geom</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.environment">fmdtools.define.environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.coords">fmdtools.define.coords</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../docs/fmdtools.sim.html">fmdtools.sim</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.sim.html#fmdtools-sim-propagate">fmdtools.sim.propagate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.sim.html#module-fmdtools.sim.scenario">fmdtools.sim.scenario</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.sim.html#module-fmdtools.sim.sample">fmdtools.sim.sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.sim.html#module-fmdtools.sim.search">fmdtools.sim.search</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../docs/fmdtools.analyze.html">fmdtools.analyze package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.analyze.html#module-fmdtools.analyze.common">fmdtools.analyze.common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.analyze.html#module-fmdtools.analyze.result">fmdtools.analyze.result</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.analyze.html#module-fmdtools.analyze.history">fmdtools.analyze.history</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.analyze.html#module-fmdtools.analyze.graph">fmdtools.analyze.graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.analyze.html#module-fmdtools.analyze.tabulate">fmdtools.analyze.tabulate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.analyze.html#module-fmdtools.analyze.phases">fmdtools.analyze.phases</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">fmdtools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../Examples.html">Examples</a></li>
      <li class="breadcrumb-item active">fmdtools-AdaStress integration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/pump/AST_Sampling.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="fmdtools-AdaStress-integration">
<h1>fmdtools-AdaStress integration<a class="headerlink" href="#fmdtools-AdaStress-integration" title="Permalink to this heading"></a></h1>
<p><strong>NOTE: This notebook may not run correctly, see ticket RAD-224</strong></p>
<p>This goal of this notebook is to illustrate running <a class="reference external" href="https://www.nasa.gov/content/tech/rse/research/adastress">Adaptive Stress Testing</a> on fmdtools model using the AdaStress package.</p>
<p>For this setup to work, first install: - AdaStress (and related packages) in Julia - fmdtools (and related packages) in Python - PyCall in Julia - PyJulia in Python</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Plots</span>
<span class="k">using</span><span class="w"> </span><span class="n">AdaStress</span>
</pre></div>
</div>
</div>
<section id="Python-setup:">
<h2>Python setup:<a class="headerlink" href="#Python-setup:" title="Permalink to this heading"></a></h2>
<p>First, we get the fmdtools model from its respective folder</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">PyCall</span>
<span class="c">#ENV[&quot;MPLBACKEND&quot;]=&quot;qt5agg&quot;</span>
<span class="k">using</span><span class="w"> </span><span class="n">PyPlot</span>
<span class="sa">py</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">import sys, os</span>
<span class="s">sys.path.insert(0,os.curdir)</span>
<span class="s">sys.path.insert(1,os.path.join(&#39;..&#39;))</span>
<span class="s">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#pygui_start(:qt)</span>
<span class="c">#PyCall.fixqtpath()</span>
</pre></div>
</div>
</div>
<p>Next, we get the module–in this case we will be using the stochastic pump model in <code class="docutils literal notranslate"><span class="pre">/example_pump/pump_stochastic</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">pump_module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;pump_stochastic&quot;</span><span class="p">)</span>
<span class="n">pump_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pump_module</span><span class="o">.</span><span class="n">Pump</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>To get the propagation/analysis methods, we can further import the fmdtools packages…</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;sim.propagate&quot;</span><span class="p">)</span>
<span class="n">an</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;analyze&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Example simulation</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">endresult</span><span class="p">,</span><span class="w"> </span><span class="n">mdlhist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prop</span><span class="o">.</span><span class="n">nominal</span><span class="p">(</span><span class="n">pump_model</span><span class="p">,</span><span class="w"> </span><span class="n">run_stochastic</span><span class="o">=</span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>NOTE: in order for <code class="docutils literal notranslate"><span class="pre">an.plot.mdlhists</span></code> to work correctly, make sure to use the <code class="docutils literal notranslate"><span class="pre">Using</span> <span class="pre">PyCall</span></code> command at the beginning.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="n">axs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mdlhist</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fxns.move_water.s.eff&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="s">&quot;fxns.move_water.s.total_flow&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="s">&quot;flows.wat_2.s.flowrate&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="s">&quot;flows.wat_2.s.pressure&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="AdaStress-Setup">
<h3>AdaStress Setup<a class="headerlink" href="#AdaStress-Setup" title="Permalink to this heading"></a></h3>
<p>Interfacing AdaStress with fmdtools models is enabled by the <code class="docutils literal notranslate"><span class="pre">DynamicProblem</span></code> class in <code class="docutils literal notranslate"><span class="pre">sim.search</span></code> (though this can also be done manually). See below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">search</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;sim.search&quot;</span><span class="p">)</span>
<span class="n">DynamicProblem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">search</span><span class="o">.</span><span class="n">DynamicInterface</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DynamicProblem</span><span class="p">(</span><span class="n">pump_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Defining the simulation is quite simple with the DynamicProblem class. Note the possible options from this class</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="n">DynamicProblem</span><span class="o">.</span><span class="n">__init__</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span><span class="o">.</span><span class="nd">@kwdef</span><span class="w"> </span><span class="k">mutable</span><span class="w"> </span><span class="k">struct</span> <span class="kt">PumpSim</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">AdaStress</span><span class="o">.</span><span class="n">BlackBox</span>
<span class="w">    </span><span class="n">sim</span><span class="o">::</span><span class="kt">PyObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DynamicProblem</span><span class="p">(</span><span class="n">pump_model</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">initialize!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span>
<span class="w">    </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DynamicProblem</span><span class="p">(</span><span class="n">pump_model</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Updating is further enabled by DynamicProblem.update</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="n">DynamicProblem</span><span class="o">.</span><span class="n">update</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">update!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span>
<span class="w">    </span><span class="n">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">0</span><span class="o">:</span><span class="mi">1_000_000_000</span><span class="p">)</span>
<span class="w">    </span><span class="n">returns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="s">&quot;pdf&quot;</span><span class="p">])</span><span class="w"> </span><span class="c"># note: needs to return a probability from somewhere - needs to be a log pdf?</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Model end-states can be interfaced with using <code class="docutils literal notranslate"><span class="pre">DynamicProblem.check_sim_end</span></code>, which additionally accomodates external conditions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">isterminal!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span>
<span class="w">    </span><span class="n">has_faults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">fxns</span><span class="p">[</span><span class="s">&quot;move_water&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">any_faults</span><span class="p">()</span><span class="w"> </span><span class="c"># our external condition</span>
<span class="w">    </span><span class="n">terminal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">check_sim_end</span><span class="p">(</span><span class="n">external_condition</span><span class="o">=</span><span class="n">has_faults</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">terminal</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">isevent!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span>
<span class="w">    </span><span class="n">faults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">fxns</span><span class="p">[</span><span class="s">&quot;move_water&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">any_faults</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">faults</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Finally, the below shows the full setup:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">AdaStress</span><span class="o">.</span><span class="n">reset!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initialize!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
<span class="n">AdaStress</span><span class="o">.</span><span class="n">step!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
<span class="n">AdaStress</span><span class="o">.</span><span class="n">isterminal</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isterminal!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
<span class="n">AdaStress</span><span class="o">.</span><span class="n">isevent</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isevent!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span><span class="w">     </span><span class="c"># difficult: get pressure &gt; 15 ten times</span>
<span class="c"># AdaStress.isevent(sim::PumpSim) = 15.0-sim.mdl.flows[&quot;Wat_1&quot;].pressure &lt;= 0 # - easy: just get pressure &gt; 15 (once!)</span>
<span class="c">#AdaStress.distance(sim::PumpSim) = 15.0-sim.mdl.flows[&quot;Wat_1&quot;].pressure</span>
<span class="n">AdaStress</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">float</span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">hist</span><span class="o">.</span><span class="n">flows</span><span class="o">.</span><span class="n">wat_1</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">pressure</span><span class="o">.&lt;=</span><span class="mi">15</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Running-AdaStress-Methods">
<h2>Running AdaStress Methods<a class="headerlink" href="#Running-AdaStress-Methods" title="Permalink to this heading"></a></h2>
<p>Monte Carlo Search</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">mcs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdaStress</span><span class="o">.</span><span class="n">Solvers</span><span class="o">.</span><span class="n">MCS</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">10_00</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">mdp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdaStress</span><span class="o">.</span><span class="n">ASTMDP</span><span class="p">(</span><span class="n">PumpSim</span><span class="p">())</span>
<span class="n">mdp</span><span class="o">.</span><span class="n">reward</span><span class="o">.</span><span class="n">event_bonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">200.0</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Random</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mcs</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">mdp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="n">mdlhists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Dict</span><span class="p">()</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">sol</span>
<span class="w">    </span><span class="n">AdaStress</span><span class="o">.</span><span class="n">replay!</span><span class="p">(</span><span class="n">mdp</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">)</span>
<span class="w">    </span><span class="n">mdlhists</span><span class="p">[</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;scen&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mdp</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">hist</span>
<span class="w">    </span><span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
<span class="k">end</span>
<span class="n">mdlhists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">an</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">History</span><span class="p">(</span><span class="n">mdlhists</span><span class="p">)</span>
<span class="n">mdlhists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mdlhists</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mdlhists</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fxns.move_water.s.eff&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;fxns.move_water.s.total_flow&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;flows.wat_2.s.flowrate&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;flows.wat_2.s.pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">comp_groups</span><span class="o">=</span><span class="kt">Dict</span><span class="p">())</span>
</pre></div>
</div>
</div>
</section>
<section id="MCTS">
<h2>MCTS<a class="headerlink" href="#MCTS" title="Permalink to this heading"></a></h2>
<p>Monte Carlo Tree Search</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">mcts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdaStress</span><span class="o">.</span><span class="n">Solvers</span><span class="o">.</span><span class="n">MCTS</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nd">@time</span><span class="w"> </span><span class="n">sol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mcts</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">mdp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="n">mdlhists2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Dict</span><span class="p">()</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">sol</span>
<span class="w">    </span><span class="n">AdaStress</span><span class="o">.</span><span class="n">replay!</span><span class="p">(</span><span class="n">mdp</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">)</span>
<span class="w">    </span><span class="n">mdlhists2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mdp</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">log</span>
<span class="w">    </span><span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">mdlhists</span><span class="p">(</span><span class="n">mdlhists2</span><span class="p">,</span><span class="w"> </span><span class="n">fxnflowvals</span><span class="o">=</span><span class="n">fxnflows2</span><span class="p">,</span><span class="w"> </span><span class="n">aggregation</span><span class="o">=</span><span class="s">&quot;percentile&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">fxnflows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;MoveWater&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;pressure&quot;</span><span class="p">,</span><span class="s">&quot;faults&quot;</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;Wat_2&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;flowrate&quot;</span><span class="p">,</span><span class="s">&quot;pressure&quot;</span><span class="p">])</span>
<span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">mdlhists</span><span class="p">(</span><span class="n">mdlhists2</span><span class="p">,</span><span class="w"> </span><span class="n">fxnflowvals</span><span class="o">=</span><span class="n">fxnflows</span><span class="p">,</span><span class="w"> </span><span class="n">legend_loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As we can see, MCTS finds more breakage faults (8 instead of 3), as a result of being a more informed search method.</p>
<section id="Grey-Box-Methods">
<h3>Grey Box Methods<a class="headerlink" href="#Grey-Box-Methods" title="Permalink to this heading"></a></h3>
<p>As opposed to black box methods, which share no information about the system state with the agent, grey box methods let the agent sample the random distributions and pass disturbances to the model directly, rather than just passing seeds.</p>
<p>Implementation is based off of: <a class="reference external" href="https://github.com/NASA-SW-VnV/AdaStress.jl/blob/master/examples/walk2d/walk2d.ipynb">https://github.com/NASA-SW-VnV/AdaStress.jl/blob/master/examples/walk2d/walk2d.ipynb</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">AdaStress</span>
<span class="k">import</span><span class="w"> </span><span class="n">AdaStress</span><span class="o">.</span><span class="n">GrayBox</span>
<span class="k">using</span><span class="w"> </span><span class="n">Distributions</span>
<span class="k">using</span><span class="w"> </span><span class="n">Random</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Pump">
<h2>Pump<a class="headerlink" href="#Pump" title="Permalink to this heading"></a></h2>
<p>To use the gray box method, we have to first define which variables in the model to sample/update. fmdtools models have two types of random states: - general random states, which are updated in the behavioral method (whose distributions thus cannot be accessed without looking at the code) - auto-updating random states, which are updated from a given distribution defined with auto_update=(dist,params). These distributions can be accessed directly from the model.</p>
<p>Both can be queried in AdaStress, but using different methods. In general, however, using a Gray Box method means that <em>all</em> stochastic behavior (desired by the analysis) should be represented in AdaStress/Julia, since integration relies on running the model as deterministic.</p>
<p>Below are the random states of the model:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">rand_states</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pump_model</span><span class="o">.</span><span class="n">get_rand_states</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>As well as the auto-updating random states:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">rand_states</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pump_model</span><span class="o">.</span><span class="n">get_rand_states</span><span class="p">(</span><span class="n">auto_update_only</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Because of the different methods that julia/AdaStress uses to sample random distributions, these distributions need to be re-implemented in julia. In this example we do this for the eff parameter in MoveWater.</p>
<p>Below we create a <code class="docutils literal notranslate"><span class="pre">Pump</span></code> struct, and define random disturbances which will affect the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#define distributions for the model</span>
<span class="c">#Base.@kwdef mutable struct Init_Rand_Params</span>
<span class="c">#    eff::Distribution = Normal(1.0, 0.2)</span>
<span class="c">#end</span>
<span class="c">#Base.@kwdef mutable struct Pump</span>
<span class="c">#    t::Float64=0.0</span>
<span class="c">#    t_max::Float64=last(pump_model.times)</span>
<span class="c">#    t_ind::Int=0</span>
<span class="c">#    mdl::PyObject = pump_model</span>
<span class="c">#end</span>
<span class="c">#function initialize(pump::Pump, init::Init_Rand_Params)</span>
<span class="c">#    pump.mdl = pump.mdl.__class__()</span>
<span class="c">#    pump.mdl.fxns[&quot;MoveWater&quot;].eff = rand(init.eff)</span>
<span class="c">#end</span>

<span class="c">#function update(pump::Pump, eff::Float64)</span>
<span class="c">#    pump.mdl.fxns[&quot;MoveWater&quot;].eff = eff</span>
<span class="c">#end</span>
</pre></div>
</div>
</div>
<p>Disturbance and failure models</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#Base.@kwdef mutable struct Disturbance</span>
<span class="c">#    eff::Distribution = Normal(1.0, 0.2)</span>
<span class="c">#end</span>
</pre></div>
</div>
</div>
<p>System under test: okay to remove, often refers to policy that we are trying to test within the system dynamics</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#mutable struct SystemUnderTest</span>
<span class="c">#    eff::Float64</span>
<span class="c">#end</span>
<span class="c">#update(pump::Pump, sut::SystemUnderTest) = update(pump, sut.eff)</span>
</pre></div>
</div>
</div>
</section>
<section id="Simulator">
<h2>Simulator<a class="headerlink" href="#Simulator" title="Permalink to this heading"></a></h2>
<p>The simulator is roughly the same as the simulation for the black box model except it has an <code class="docutils literal notranslate"><span class="pre">environment</span></code> which samples stochastic variables and then changes parameters in the model. Note that in this case <code class="docutils literal notranslate"><span class="pre">run_stochastic</span></code> is set to <code class="docutils literal notranslate"><span class="pre">false</span></code>, since the variables are being sampled in AdaStress itself (rather than the model).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span><span class="o">.</span><span class="nd">@kwdef</span><span class="w"> </span><span class="k">mutable</span><span class="w"> </span><span class="k">struct</span> <span class="kt">Simulator</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">AdaStress</span><span class="o">.</span><span class="n">GrayBox</span>
<span class="w">    </span><span class="n">sim</span><span class="o">::</span><span class="kt">PyObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DynamicProblem</span><span class="p">(</span><span class="n">pump_model</span><span class="p">)</span>
<span class="w">    </span><span class="n">env</span><span class="o">::</span><span class="kt">AdaStress</span><span class="o">.</span><span class="n">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdaStress</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">initialize</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span>
<span class="w">    </span><span class="n">sim</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="ss">:eff</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Normal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">)</span><span class="w"> </span><span class="c">#creating</span>
<span class="w">    </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">=</span><span class="n">DynamicProblem</span><span class="p">(</span><span class="n">pump_model</span><span class="p">,</span><span class="w"> </span><span class="n">run_stochastic</span><span class="o">=</span><span class="nb">false</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">update!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">::</span><span class="kt">AdaStress</span><span class="o">.</span><span class="n">EnvironmentValue</span><span class="p">)</span>
<span class="w">    </span><span class="c">#sim.mdl.set_values(&quot;MoveWater.eff&quot;, value[:eff])</span>
<span class="w">    </span><span class="n">disturbances</span><span class="o">=</span><span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;MoveWater.eff&quot;</span><span class="o">=&gt;</span><span class="n">value</span><span class="p">[</span><span class="ss">:eff</span><span class="p">])</span>
<span class="w">    </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">disturbances</span><span class="o">=</span><span class="n">disturbances</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>The isterminal and isevent functions will be the same as in the black box model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">isterminal!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span>
<span class="w">    </span><span class="n">has_faults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">fxns</span><span class="p">[</span><span class="s">&quot;MoveWater&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">any_faults</span><span class="p">()</span><span class="w"> </span><span class="c"># our external condition</span>
<span class="w">    </span><span class="n">terminal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">check_sim_end</span><span class="p">(</span><span class="n">external_condition</span><span class="o">=</span><span class="n">has_faults</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">terminal</span>
<span class="k">end</span>
<span class="k">function</span><span class="w"> </span><span class="n">isevent!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span>
<span class="w">    </span><span class="n">faults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">fxns</span><span class="p">[</span><span class="s">&quot;MoveWater&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">any_faults</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">faults</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>The interface to adastress is set up below. Of note is the observation interface, which observes <code class="docutils literal notranslate"><span class="pre">eff</span></code> (which is also the action in this simple setup)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Interface</span><span class="o">.</span><span class="n">reset!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initialize</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">environment</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim</span><span class="o">.</span><span class="n">env</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vcat</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">flows</span><span class="p">[</span><span class="s">&quot;Wat_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">t_max</span><span class="p">)</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">step!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">::</span><span class="kt">AdaStress</span><span class="o">.</span><span class="n">EnvironmentValue</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update!</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">isterminal</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isterminal!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">isevent</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isevent!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">float</span><span class="p">(</span><span class="n">sum</span><span class="p">([(</span><span class="mi">16</span><span class="o">-</span><span class="n">max</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="s">&quot;flows&quot;</span><span class="p">][</span><span class="s">&quot;Wat_1&quot;</span><span class="p">][</span><span class="s">&quot;pressure&quot;</span><span class="p">]]))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">mdp_env</span><span class="p">(;</span><span class="w"> </span><span class="n">kwargs</span><span class="o">...</span><span class="p">)</span>
<span class="w">    </span><span class="n">mdp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Interface</span><span class="o">.</span><span class="n">ASTMDP</span><span class="p">(</span><span class="n">Simulator</span><span class="p">(;</span><span class="w"> </span><span class="n">kwargs</span><span class="o">...</span><span class="p">))</span>
<span class="w">    </span><span class="n">mdp</span><span class="o">.</span><span class="n">rewaan</span><span class="o">.</span><span class="n">event_bonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2000.0</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">mdp</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Now using the gray box mdp solver:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">AdaStress</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s">&quot;SoftActorCritic&quot;</span><span class="p">)</span>
<span class="k">using</span><span class="w"> </span><span class="n">AdaStress</span><span class="o">.</span><span class="n">SoftActorCritic</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SAC</span><span class="p">(;</span>
<span class="w">    </span><span class="n">obs_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">act_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">gamma</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
<span class="w">    </span><span class="n">act_mins</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w">    </span><span class="c">#number of standard deviations</span>
<span class="w">    </span><span class="n">act_maxs</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="w">    </span><span class="n">hidden_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span>
<span class="w">    </span><span class="n">num_q</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">max_buffer_size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
<span class="w">    </span><span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<span class="w">    </span><span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="n">update_after</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">update_every</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">steps_per_epoch</span><span class="o">=</span><span class="mi">54</span><span class="p">,</span>
<span class="w">    </span><span class="n">start_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="n">max_ep_len</span><span class="o">=</span><span class="mi">54</span><span class="p">,</span>
<span class="w">    </span><span class="n">num_test_episodes</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="n">displays</span><span class="o">=</span><span class="p">[(</span><span class="ss">:fails</span><span class="p">,</span><span class="w"> </span><span class="n">mdp</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">mdp</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">fxns</span><span class="p">[</span><span class="s">&quot;MoveWater&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">has_fault</span><span class="p">(</span><span class="s">&quot;mech_break&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)],</span>
<span class="w">    </span><span class="n">use_gpu</span><span class="o">=</span><span class="nb">false</span>
<span class="p">)</span>

<span class="n">SoftActorCritic</span><span class="o">.</span><span class="n">ProgressMeter</span><span class="o">.</span><span class="n">ijulia_behavior</span><span class="p">(</span><span class="ss">:clear</span><span class="p">)</span>
<span class="n">ac</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sac</span><span class="p">(</span><span class="n">mdp_env</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">PyPlot</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&quot;fails&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&quot;score&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ac</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="n">mdlhists3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Dict</span><span class="p">()</span>
<span class="n">mdp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mdp_env</span><span class="p">()</span>
<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">100</span>
<span class="w">    </span><span class="n">a</span><span class="o">=</span><span class="w"> </span><span class="n">AdaStress</span><span class="o">.</span><span class="n">replay!</span><span class="p">(</span><span class="n">mdp</span><span class="p">,</span><span class="w"> </span><span class="n">ac</span><span class="p">)</span>
<span class="w">    </span><span class="n">mdlhists3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mdp</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">log</span>
<span class="w">    </span><span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">=</span><span class="w"> </span><span class="n">AdaStress</span><span class="o">.</span><span class="n">replay!</span><span class="p">(</span><span class="n">mdp</span><span class="p">,</span><span class="w"> </span><span class="n">ac</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">fxnflows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;MoveWater&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;eff&quot;</span><span class="p">,</span><span class="s">&quot;total_flow&quot;</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;Wat_2&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;flowrate&quot;</span><span class="p">,</span><span class="s">&quot;pressure&quot;</span><span class="p">])</span>
<span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">mdlhists</span><span class="p">(</span><span class="n">mdlhists3</span><span class="p">,</span><span class="w"> </span><span class="n">fxnflowvals</span><span class="o">=</span><span class="n">fxnflows</span><span class="p">,</span><span class="w"> </span><span class="n">legend_loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">fxnflows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;MoveWater&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;pressure&quot;</span><span class="p">,</span><span class="s">&quot;faults&quot;</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;Wat_2&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;flowrate&quot;</span><span class="p">,</span><span class="s">&quot;pressure&quot;</span><span class="p">])</span>
<span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">mdlhists</span><span class="p">(</span><span class="n">mdlhists3</span><span class="p">,</span><span class="w"> </span><span class="n">fxnflowvals</span><span class="o">=</span><span class="n">fxnflows</span><span class="p">,</span><span class="w"> </span><span class="n">legend_loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Stochastic_Modelling.html" class="btn btn-neutral float-left" title="Stochastic Modelling in fmdtools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../multirotor/Demonstration.html" class="btn btn-neutral float-right" title="fmdtools Paper Demonstration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
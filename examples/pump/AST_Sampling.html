<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fmdtools-AdaStress integration &mdash; fmdtools 2.0-alpha documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/fmdtools_ico.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/logo_glow.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">README</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../README.html#contributions">Contributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#contributors">Contributors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../README.html#notices">Notices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#disclaimers">Disclaimers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/Development%20Guide.html">Development Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../docs/Development%20Guide.html#contributions">Contributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#repo-structure">Repo Structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../docs/Development%20Guide.html#remote-structure">Remote Structure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#development-process">Development Process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../docs/Development%20Guide.html#upload-to-pypi">Upload to PyPI</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#roles">Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../docs/Development%20Guide.html#model-development-best-practices">Model Development Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#plan-your-model-to-avoid-technical-debt">Plan your model to avoid technical debt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#don-t-copy-inherit-and-functionalize">Don’t copy, inherit and functionalize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#document-your-code-sometimes-before-your-write-it">Document your code, sometimes <em>before</em> your write it</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#don-t-get-ahead-of-yourself-try-to-get-a-running-simulation-first">Don’t get ahead of yourself–try to get a running simulation first</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#preserve-your-prototype-setup-by-formalizing-it-as-a-test">Preserve your prototype setup by formalizing it as a test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#edit-your-code">Edit your code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#structuring-a-model">Structuring a model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#use-model-constructs-to-simplify-your-code">Use model constructs to simplify your code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#style-advice">Style advice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/Development%20Guide.html#see-also">See also</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/Examples.html">Examples</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/Glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/fmdtools.html">Module Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../docs/fmdtools.define.html">fmdtools.define package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.block">fmdtools.define.block</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.common">fmdtools.define.common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.flow">fmdtools.define.flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.mode">fmdtools.define.mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.model">fmdtools.define.model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.parameter">fmdtools.define.parameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.rand">fmdtools.define.rand</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.state">fmdtools.define.state</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.define.html#module-fmdtools.define.time">fmdtools.define.time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../docs/fmdtools.sim.html">fmdtools.sim</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.sim.html#fmdtools-sim-propagate">fmdtools.sim.propagate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.sim.html#module-fmdtools.sim.scenario">fmdtools.sim.scenario</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.sim.html#module-fmdtools.sim.approach">fmdtools.sim.approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.sim.html#module-fmdtools.sim.search">fmdtools.sim.search</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../docs/fmdtools.analyze.html">fmdtools.analyze package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.analyze.html#module-fmdtools.analyze.result">fmdtools.analyze.result</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.analyze.html#module-fmdtools.analyze.plot">fmdtools.analyze.plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.analyze.html#module-fmdtools.analyze.graph">fmdtools.analyze.graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docs/fmdtools.analyze.html#module-fmdtools.analyze.tabulate">fmdtools.analyze.tabulate</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">fmdtools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>fmdtools-AdaStress integration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/pump/AST_Sampling.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="fmdtools-AdaStress-integration">
<h1>fmdtools-AdaStress integration<a class="headerlink" href="#fmdtools-AdaStress-integration" title="Permalink to this headline"></a></h1>
<p><strong>NOTE: This notebook may not run correctly, see ticket RAD-224</strong></p>
<p>This goal of this notebook is to illustrate running Adaptive Stress Testing on fmdtools model using the AdaStress package.</p>
<p>For this setup to work, first install: - AdaStress (and related packages) in Julia - fmdtools (and related packages) in Python - PyCall in Julia - PyJulia in Python</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Plots</span>
<span class="k">using</span> <span class="n">AdaStress</span>
</pre></div>
</div>
</div>
<section id="Python-setup:">
<h2>Python setup:<a class="headerlink" href="#Python-setup:" title="Permalink to this headline"></a></h2>
<p>First, we get the fmdtools model from its respective folder</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">PyCall</span>
<span class="c">#ENV[&quot;MPLBACKEND&quot;]=&quot;qt5agg&quot;</span>
<span class="k">using</span> <span class="n">PyPlot</span>
<span class="sa">py</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">import sys, os</span>
<span class="s">sys.path.insert(0,os.curdir)</span>
<span class="s">sys.path.insert(1,os.path.join(&#39;..&#39;))</span>
<span class="s">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#pygui_start(:qt)</span>
<span class="c">#PyCall.fixqtpath()</span>
</pre></div>
</div>
</div>
<p>Next, we get the module–in this case we will be using the stochastic pump model in <code class="docutils literal notranslate"><span class="pre">/example_pump/pump_stochastic</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">pump_module</span> <span class="o">=</span> <span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;pump_stochastic&quot;</span><span class="p">)</span>
<span class="n">pump_model</span> <span class="o">=</span> <span class="n">pump_module</span><span class="o">.</span><span class="n">Pump</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PyObject Pump model at 0x6a293c40
FUNCTIONS:
import_ee ImportEE
- ImportEEState(effstate=1.0)
- ImportEEMode(mode=nominal, faults=set())
import_water ImportWater
- State()
- ImportWaterMode(mode=nominal, faults=set())
import_signal ImportSig
- State()
- ImportSigMode(mode=nominal, faults=set())
move_water MoveWat
- MoveWatStates(total_flow=0.0, eff=1.0)
- MoveWatMode(mode=nominal, faults=set())
export_water ExportWater
- State()
- ExportWaterMode(mode=nominal, faults=set())
FLOWS:
ee_1 Electricity flow: EEStates(current=1.0, voltage=1.0)
sig_1 Signal flow: SignalStates(power=1.0)
Wat_1 Water flow: WaterStates(flowrate=1.0, pressure=1.0, area=1.0, level=1.0)
Wat_1 Water flow: WaterStates(flowrate=1.0, pressure=1.0, area=1.0, level=1.0)

</pre></div></div>
</div>
<p>To get the propagation/analysis methods, we can further import the fmdtools packages…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">prop</span> <span class="o">=</span> <span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;sim.propagate&quot;</span><span class="p">)</span>
<span class="n">an</span> <span class="o">=</span> <span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;analyze&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PyObject &lt;module &#39;analyze&#39; from &#39;C:\\Users\\dhulse\\Documents\\GitHub\\fmdtools\\fmdtools\\analyze\\__init__.py&#39;&gt;
</pre></div></div>
</div>
<p>Example simulation</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">endresult</span><span class="p">,</span> <span class="n">mdlhist</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">nominal</span><span class="p">(</span><span class="n">pump_model</span><span class="p">,</span> <span class="n">run_stochastic</span><span class="o">=</span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>NOTE: in order for <code class="docutils literal notranslate"><span class="pre">an.plot.mdlhists</span></code> to work correctly, make sure to use the <code class="docutils literal notranslate"><span class="pre">Using</span> <span class="pre">PyCall</span></code> command at the beginning.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mdlhist</span><span class="p">,</span> <span class="s">&quot;fxns.move_water.s.eff&quot;</span><span class="p">,</span>
                                 <span class="s">&quot;fxns.move_water.s.total_flow&quot;</span><span class="p">,</span>
                                 <span class="s">&quot;flows.wat_2.s.flowrate&quot;</span><span class="p">,</span>
                                 <span class="s">&quot;flows.wat_2.s.pressure&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_pump_AST_Sampling_12_0.png" src="../../_images/examples_pump_AST_Sampling_12_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(Figure(PyObject &lt;Figure size 600x400 with 4 Axes&gt;), PyObject[PyObject &lt;AxesSubplot:title={&#39;center&#39;:&#39;fxns.move_water.s.eff&#39;}&gt;, PyObject &lt;AxesSubplot:title={&#39;center&#39;:&#39;fxns.move_water.s.total_flow&#39;}&gt;, PyObject &lt;AxesSubplot:title={&#39;center&#39;:&#39;flows.wat_2.s.flowrate&#39;}, xlabel=&#39;time&#39;&gt;, PyObject &lt;AxesSubplot:title={&#39;center&#39;:&#39;flows.wat_2.s.pressure&#39;}, xlabel=&#39;time&#39;&gt;])
</pre></div></div>
</div>
<section id="AdaStress-Setup">
<h3>AdaStress Setup<a class="headerlink" href="#AdaStress-Setup" title="Permalink to this headline"></a></h3>
<p>Interfacing AdaStress with fmdtools models is enabled by the <code class="docutils literal notranslate"><span class="pre">DynamicProblem</span></code> class in <code class="docutils literal notranslate"><span class="pre">sim.search</span></code> (though this can also be done manually). See below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">search</span> <span class="o">=</span> <span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;sim.search&quot;</span><span class="p">)</span>
<span class="n">DynamicProblem</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">DynamicInterface</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PyObject &lt;class &#39;sim.search.DynamicInterface&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">prob</span> <span class="o">=</span> <span class="n">DynamicProblem</span><span class="p">(</span><span class="n">pump_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PyObject &lt;sim.search.DynamicInterface object at 0x0000000063E96FA0&gt;
</pre></div></div>
</div>
<p>Defining the simulation is quite simple with the DynamicProblem class. Note the possible options from this class</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="n">DynamicProblem</span><span class="o">.</span><span class="n">__init__</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

        Initializing the problem

        Parameters
        ----------
        mdl : Model
            Model defining the simulation.
        mdl_kwargs : dict, optional
            Parameters to run the model at. The default is {}.
        t_max : float, optional
            Maximum simulation time. The default is False.
        track : str/dict, optional
            Properties of the model to track over time. The default is &#34;all&#34;.
        run_stochastic : bool/str, optional
            Whether to run stochastic behaviors (True/False) and/or return pdf &#34;track_pdf&#34;. The default is &#34;track_pdf&#34;.
        desired_result : list, optional
            List of desired results to return at each update. The default is [].
        use_end_condition : bool, optional
            Whether to use model end-condition. The default is None.

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span><span class="o">.</span><span class="nd">@kwdef</span> <span class="k">mutable struct</span> <span class="kt">PumpSim</span> <span class="o">&lt;:</span> <span class="kt">AdaStress</span><span class="o">.</span><span class="n">BlackBox</span>
    <span class="n">sim</span><span class="o">::</span><span class="kt">PyObject</span> <span class="o">=</span> <span class="n">DynamicProblem</span><span class="p">(</span><span class="n">pump_model</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PumpSim
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">initialize!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">sim</span> <span class="o">=</span> <span class="n">DynamicProblem</span><span class="p">(</span><span class="n">pump_model</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
initialize! (generic function with 1 method)
</pre></div></div>
</div>
<p>Updating is further enabled by DynamicProblem.update</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="n">DynamicProblem</span><span class="o">.</span><span class="n">update</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

        Updates the model states at the simulation time and iterates time

        Parameters
        ----------
        seed : seed, optional
            Seed for the simulation. The default is {}.
        faults : dict, optional
            faults to inject in the model, with structure {fxn:[faults]}. The default is {}.
        disturbances : dict, optional
            Variables to change in the model, with structure {fxn.var:value}. The default is {}.

        Returns
        -------
        returns : dict
            dictionary of returns with values corresponding to desired_result

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">update!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">0</span><span class="o">:</span><span class="mi">1_000_000_000</span><span class="p">)</span>
    <span class="n">returns</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">log</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="s">&quot;pdf&quot;</span><span class="p">])</span> <span class="c"># note: needs to return a probability from somewhere - needs to be a log pdf?</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
update! (generic function with 1 method)
</pre></div></div>
</div>
<p>Model end-states can be interfaced with using <code class="docutils literal notranslate"><span class="pre">DynamicProblem.check_sim_end</span></code>, which additionally accomodates external conditions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">isterminal!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span>
    <span class="n">has_faults</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">fxns</span><span class="p">[</span><span class="s">&quot;move_water&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">any_faults</span><span class="p">()</span> <span class="c"># our external condition</span>
    <span class="n">terminal</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">check_sim_end</span><span class="p">(</span><span class="n">external_condition</span><span class="o">=</span><span class="n">has_faults</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">terminal</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
isterminal! (generic function with 1 method)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">isevent!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span>
    <span class="n">faults</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">fxns</span><span class="p">[</span><span class="s">&quot;move_water&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">any_faults</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">faults</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
isevent! (generic function with 1 method)
</pre></div></div>
</div>
<p>Finally, the below shows the full setup:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">AdaStress</span><span class="o">.</span><span class="n">reset!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span> <span class="o">=</span> <span class="n">initialize!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
<span class="n">AdaStress</span><span class="o">.</span><span class="n">step!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span> <span class="o">=</span> <span class="n">update!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
<span class="n">AdaStress</span><span class="o">.</span><span class="n">isterminal</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span> <span class="o">=</span> <span class="n">isterminal!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
<span class="n">AdaStress</span><span class="o">.</span><span class="n">isevent</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span> <span class="o">=</span> <span class="n">isevent!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>     <span class="c"># difficult: get pressure &gt; 15 ten times</span>
<span class="c"># AdaStress.isevent(sim::PumpSim) = 15.0-sim.mdl.flows[&quot;Wat_1&quot;].pressure &lt;= 0 # - easy: just get pressure &gt; 15 (once!)</span>
<span class="c">#AdaStress.distance(sim::PumpSim) = 15.0-sim.mdl.flows[&quot;Wat_1&quot;].pressure</span>
<span class="n">AdaStress</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">PumpSim</span><span class="p">)</span> <span class="o">=</span> <span class="n">float</span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">hist</span><span class="o">.</span><span class="n">flows</span><span class="o">.</span><span class="n">wat_1</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">pressure</span><span class="o">.&lt;=</span><span class="mi">15</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Running-AdaStress-Methods">
<h2>Running AdaStress Methods<a class="headerlink" href="#Running-AdaStress-Methods" title="Permalink to this headline"></a></h2>
<p>Monte Carlo Search</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">mcs</span> <span class="o">=</span> <span class="n">AdaStress</span><span class="o">.</span><span class="n">Solvers</span><span class="o">.</span><span class="n">MCS</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">10_00</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
AdaStress.Solvers.MonteCarloSearch.MCS(1000, 10)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">mdp</span> <span class="o">=</span> <span class="n">AdaStress</span><span class="o">.</span><span class="n">ASTMDP</span><span class="p">(</span><span class="n">PumpSim</span><span class="p">())</span>
<span class="n">mdp</span><span class="o">.</span><span class="n">reward</span><span class="o">.</span><span class="n">event_bonus</span> <span class="o">=</span> <span class="mf">200.0</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
200.0
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Random</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">mcs</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="n">mdp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PyError ($(Expr(:escape, :(ccall(#= C:\Users\dhulse\.julia\packages\PyCall\7a7w0\src\pyfncall.jl:43 =# @pysym(:PyObject_Call), PyPtr, (PyPtr, PyPtr, PyPtr), o, pyargsptr, kw))))) &lt;class &#39;AttributeError&#39;&gt;
AttributeError(&#34;module &#39;fmdtools.sim.propagate&#39; has no attribute &#39;cut_mdlhist&#39;&#34;)
  File &#34;C:\Users\dhulse\Documents\GitHub\fmdtools\fmdtools\sim\search.py&#34;, line 935, in check_sim_end
    prop.cut_mdlhist(self.log, self.t_ind)


Stacktrace:
  [1] pyerr_check
    @ C:\Users\dhulse\.julia\packages\PyCall\7a7w0\src\exception.jl:62 [inlined]
  [2] pyerr_check
    @ C:\Users\dhulse\.julia\packages\PyCall\7a7w0\src\exception.jl:66 [inlined]
  [3] _handle_error(msg::String)
    @ PyCall C:\Users\dhulse\.julia\packages\PyCall\7a7w0\src\exception.jl:83
  [4] macro expansion
    @ C:\Users\dhulse\.julia\packages\PyCall\7a7w0\src\exception.jl:97 [inlined]
  [5] #107
    @ C:\Users\dhulse\.julia\packages\PyCall\7a7w0\src\pyfncall.jl:43 [inlined]
  [6] disable_sigint
    @ .\c.jl:458 [inlined]
  [7] __pycall!
    @ C:\Users\dhulse\.julia\packages\PyCall\7a7w0\src\pyfncall.jl:42 [inlined]
  [8] _pycall!(ret::PyObject, o::PyObject, args::Tuple{}, nargs::Int64, kw::PyObject)
    @ PyCall C:\Users\dhulse\.julia\packages\PyCall\7a7w0\src\pyfncall.jl:29
  [9] _pycall!
    @ C:\Users\dhulse\.julia\packages\PyCall\7a7w0\src\pyfncall.jl:11 [inlined]
 [10] (::PyObject)(; kwargs::Base.Pairs{Symbol, Bool, Tuple{Symbol}, NamedTuple{(:external_condition,), Tuple{Bool}}})
    @ PyCall C:\Users\dhulse\.julia\packages\PyCall\7a7w0\src\pyfncall.jl:86
 [11] isterminal!(sim::PumpSim)
    @ Main .\In[15]:3
 [12] isterminal
    @ .\In[17]:3 [inlined]
 [13] terminated(mdp::AdaStress.Interface.ASTMDP{AdaStress.Interface.UnobservableState, AdaStress.Interface.SeedAction})
    @ AdaStress.Interface C:\Users\dhulse\.julia\packages\AdaStress\RFXZv\src\interface\RL.jl:99
 [14] terminated(mdp::AdaStress.Interface.ASTMDP{AdaStress.Interface.UnobservableState, AdaStress.Interface.SeedAction})
    @ AdaStress.Interface C:\Users\dhulse\.julia\packages\AdaStress\RFXZv\src\interface\RL.jl:111
 [15] macro expansion
    @ C:\Users\dhulse\.julia\packages\AdaStress\RFXZv\src\solvers\local\MonteCarloSearch\MonteCarloSearch.jl:78 [inlined]
 [16] macro expansion
    @ C:\Users\dhulse\.julia\packages\ProgressMeter\sN2xr\src\ProgressMeter.jl:938 [inlined]
 [17] solve(mcs::AdaStress.Solvers.MonteCarloSearch.MCS, env_fn::var&#34;#2#3&#34;)
    @ AdaStress.Solvers.MonteCarloSearch C:\Users\dhulse\.julia\packages\AdaStress\RFXZv\src\solvers\local\MonteCarloSearch\MonteCarloSearch.jl:72
 [18] (::AdaStress.Solvers.MonteCarloSearch.MCS)(env_fn::Function)
    @ AdaStress.Solvers C:\Users\dhulse\.julia\packages\AdaStress\RFXZv\src\solvers\types.jl:74
 [19] top-level scope
    @ In[21]:2
 [20] eval
    @ .\boot.jl:373 [inlined]
 [21] include_string(mapexpr::typeof(REPL.softscope), mod::Module, code::String, filename::String)
    @ Base .\loading.jl:1196
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="n">mdlhists</span> <span class="o">=</span> <span class="kt">Dict</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">in</span> <span class="n">sol</span>
    <span class="n">AdaStress</span><span class="o">.</span><span class="n">replay!</span><span class="p">(</span><span class="n">mdp</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">mdlhists</span><span class="p">[</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;scen&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">mdp</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">hist</span>
    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
<span class="k">end</span>
<span class="n">mdlhists</span> <span class="o">=</span> <span class="n">an</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">History</span><span class="p">(</span><span class="n">mdlhists</span><span class="p">)</span>
<span class="n">mdlhists</span> <span class="o">=</span> <span class="n">mdlhists</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mdlhists</span><span class="p">,</span> <span class="s">&quot;fxns.move_water.s.eff&quot;</span><span class="p">,</span>
                        <span class="s">&quot;fxns.move_water.s.total_flow&quot;</span><span class="p">,</span>
                        <span class="s">&quot;flows.wat_2.s.flowrate&quot;</span><span class="p">,</span>
                        <span class="s">&quot;flows.wat_2.s.pressure&quot;</span><span class="p">,</span> <span class="n">comp_groups</span><span class="o">=</span><span class="kt">Dict</span><span class="p">())</span>
</pre></div>
</div>
</div>
</section>
<section id="MCTS">
<h2>MCTS<a class="headerlink" href="#MCTS" title="Permalink to this headline"></a></h2>
<p>Monte Carlo Tree Search</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">mcts</span> <span class="o">=</span> <span class="n">AdaStress</span><span class="o">.</span><span class="n">Solvers</span><span class="o">.</span><span class="n">MCTS</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nd">@time</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">mcts</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="n">mdp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="n">mdlhists2</span> <span class="o">=</span> <span class="kt">Dict</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">in</span> <span class="n">sol</span>
    <span class="n">AdaStress</span><span class="o">.</span><span class="n">replay!</span><span class="p">(</span><span class="n">mdp</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="n">mdlhists2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdp</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">log</span>
    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">mdlhists</span><span class="p">(</span><span class="n">mdlhists2</span><span class="p">,</span> <span class="n">fxnflowvals</span><span class="o">=</span><span class="n">fxnflows2</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="s">&quot;percentile&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">fxnflows</span> <span class="o">=</span> <span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;MoveWater&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;pressure&quot;</span><span class="p">,</span><span class="s">&quot;faults&quot;</span><span class="p">],</span> <span class="s">&quot;Wat_2&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;flowrate&quot;</span><span class="p">,</span><span class="s">&quot;pressure&quot;</span><span class="p">])</span>
<span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">mdlhists</span><span class="p">(</span><span class="n">mdlhists2</span><span class="p">,</span> <span class="n">fxnflowvals</span><span class="o">=</span><span class="n">fxnflows</span><span class="p">,</span> <span class="n">legend_loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As we can see, MCTS finds more breakage faults (8 instead of 3), as a result of being a more informed search method.</p>
<section id="Grey-Box-Methods">
<h3>Grey Box Methods<a class="headerlink" href="#Grey-Box-Methods" title="Permalink to this headline"></a></h3>
<p>As opposed to black box methods, which share no information about the system state with the agent, grey box methods let the agent sample the random distributions and pass disturbances to the model directly, rather than just passing seeds.</p>
<p>Implementation is based off of: <a class="reference external" href="https://github.com/NASA-SW-VnV/AdaStress.jl/blob/master/examples/walk2d/walk2d.ipynb">https://github.com/NASA-SW-VnV/AdaStress.jl/blob/master/examples/walk2d/walk2d.ipynb</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">AdaStress</span>
<span class="k">import</span> <span class="n">AdaStress</span><span class="o">.</span><span class="n">GrayBox</span>
<span class="k">using</span> <span class="n">Distributions</span>
<span class="k">using</span> <span class="n">Random</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Pump">
<h2>Pump<a class="headerlink" href="#Pump" title="Permalink to this headline"></a></h2>
<p>To use the gray box method, we have to first define which variables in the model to sample/update. fmdtools models have two types of random states: - general random states, which are updated in the behavioral method (whose distributions thus cannot be accessed without looking at the code) - auto-updating random states, which are updated from a given distribution defined with auto_update=(dist,params). These distributions can be accessed directly from the model.</p>
<p>Both can be queried in AdaStress, but using different methods. In general, however, using a Gray Box method means that <em>all</em> stochastic behavior (desired by the analysis) should be represented in AdaStress/Julia, since integration relies on running the model as deterministic.</p>
<p>Below are the random states of the model:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">rand_states</span> <span class="o">=</span> <span class="n">pump_model</span><span class="o">.</span><span class="n">get_rand_states</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>As well as the auto-updating random states:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">rand_states</span> <span class="o">=</span> <span class="n">pump_model</span><span class="o">.</span><span class="n">get_rand_states</span><span class="p">(</span><span class="n">auto_update_only</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Because of the different methods that julia/AdaStress uses to sample random distributions, these distributions need to be re-implemented in julia. In this example we do this for the eff parameter in MoveWater.</p>
<p>Below we create a <code class="docutils literal notranslate"><span class="pre">Pump</span></code> struct, and define random disturbances which will affect the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#define distributions for the model</span>
<span class="c">#Base.@kwdef mutable struct Init_Rand_Params</span>
<span class="c">#    eff::Distribution = Normal(1.0, 0.2)</span>
<span class="c">#end</span>
<span class="c">#Base.@kwdef mutable struct Pump</span>
<span class="c">#    t::Float64=0.0</span>
<span class="c">#    t_max::Float64=last(pump_model.times)</span>
<span class="c">#    t_ind::Int=0</span>
<span class="c">#    mdl::PyObject = pump_model</span>
<span class="c">#end</span>
<span class="c">#function initialize(pump::Pump, init::Init_Rand_Params)</span>
<span class="c">#    pump.mdl = pump.mdl.__class__()</span>
<span class="c">#    pump.mdl.fxns[&quot;MoveWater&quot;].eff = rand(init.eff)</span>
<span class="c">#end</span>

<span class="c">#function update(pump::Pump, eff::Float64)</span>
<span class="c">#    pump.mdl.fxns[&quot;MoveWater&quot;].eff = eff</span>
<span class="c">#end</span>
</pre></div>
</div>
</div>
<p>Disturbance and failure models</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#Base.@kwdef mutable struct Disturbance</span>
<span class="c">#    eff::Distribution = Normal(1.0, 0.2)</span>
<span class="c">#end</span>
</pre></div>
</div>
</div>
<p>System under test: okay to remove, often refers to policy that we are trying to test within the system dynamics</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#mutable struct SystemUnderTest</span>
<span class="c">#    eff::Float64</span>
<span class="c">#end</span>
<span class="c">#update(pump::Pump, sut::SystemUnderTest) = update(pump, sut.eff)</span>
</pre></div>
</div>
</div>
</section>
<section id="Simulator">
<h2>Simulator<a class="headerlink" href="#Simulator" title="Permalink to this headline"></a></h2>
<p>The simulator is roughly the same as the simulation for the black box model except it has an <code class="docutils literal notranslate"><span class="pre">environment</span></code> which samples stochastic variables and then changes parameters in the model. Note that in this case <code class="docutils literal notranslate"><span class="pre">run_stochastic</span></code> is set to <code class="docutils literal notranslate"><span class="pre">false</span></code>, since the variables are being sampled in AdaStress itself (rather than the model).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span><span class="o">.</span><span class="nd">@kwdef</span> <span class="k">mutable struct</span> <span class="kt">Simulator</span> <span class="o">&lt;:</span> <span class="kt">AdaStress</span><span class="o">.</span><span class="n">GrayBox</span>
    <span class="n">sim</span><span class="o">::</span><span class="kt">PyObject</span> <span class="o">=</span> <span class="n">DynamicProblem</span><span class="p">(</span><span class="n">pump_model</span><span class="p">)</span>
    <span class="n">env</span><span class="o">::</span><span class="kt">AdaStress</span><span class="o">.</span><span class="n">Environment</span> <span class="o">=</span> <span class="n">AdaStress</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">initialize</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="ss">:eff</span><span class="p">]</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span> <span class="c">#creating</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">=</span><span class="n">DynamicProblem</span><span class="p">(</span><span class="n">pump_model</span><span class="p">,</span> <span class="n">run_stochastic</span><span class="o">=</span><span class="nb">false</span><span class="p">)</span>
    <span class="k">return</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">update!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">,</span> <span class="n">value</span><span class="o">::</span><span class="kt">AdaStress</span><span class="o">.</span><span class="n">EnvironmentValue</span><span class="p">)</span>
    <span class="c">#sim.mdl.set_values(&quot;MoveWater.eff&quot;, value[:eff])</span>
    <span class="n">disturbances</span><span class="o">=</span><span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;MoveWater.eff&quot;</span><span class="o">=&gt;</span><span class="n">value</span><span class="p">[</span><span class="ss">:eff</span><span class="p">])</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">disturbances</span><span class="o">=</span><span class="n">disturbances</span><span class="p">)</span>
    <span class="k">return</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>The isterminal and isevent functions will be the same as in the black box model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">isterminal!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span>
    <span class="n">has_faults</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">fxns</span><span class="p">[</span><span class="s">&quot;MoveWater&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">any_faults</span><span class="p">()</span> <span class="c"># our external condition</span>
    <span class="n">terminal</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">check_sim_end</span><span class="p">(</span><span class="n">external_condition</span><span class="o">=</span><span class="n">has_faults</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">terminal</span>
<span class="k">end</span>
<span class="k">function</span> <span class="n">isevent!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span>
    <span class="n">faults</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">fxns</span><span class="p">[</span><span class="s">&quot;MoveWater&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">any_faults</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">faults</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>The interface to adastress is set up below. Of note is the observation interface, which observes <code class="docutils literal notranslate"><span class="pre">eff</span></code> (which is also the action in this simple setup)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Interface</span><span class="o">.</span><span class="n">reset!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span> <span class="o">=</span> <span class="n">initialize</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">environment</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">env</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span> <span class="o">=</span> <span class="n">vcat</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">flows</span><span class="p">[</span><span class="s">&quot;Wat_2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span> <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">t_max</span><span class="p">)</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">step!</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">,</span> <span class="n">value</span><span class="o">::</span><span class="kt">AdaStress</span><span class="o">.</span><span class="n">EnvironmentValue</span><span class="p">)</span> <span class="o">=</span> <span class="n">update!</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">isterminal</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span> <span class="o">=</span> <span class="n">isterminal!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">isevent</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span> <span class="o">=</span> <span class="n">isevent!</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

<span class="n">Interface</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">sim</span><span class="o">::</span><span class="kt">Simulator</span><span class="p">)</span> <span class="o">=</span> <span class="n">float</span><span class="p">(</span><span class="n">sum</span><span class="p">([(</span><span class="mi">16</span><span class="o">-</span><span class="n">max</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span><span class="o">^</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="s">&quot;flows&quot;</span><span class="p">][</span><span class="s">&quot;Wat_1&quot;</span><span class="p">][</span><span class="s">&quot;pressure&quot;</span><span class="p">]]))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">mdp_env</span><span class="p">(;</span> <span class="n">kwargs</span><span class="o">...</span><span class="p">)</span>
    <span class="n">mdp</span> <span class="o">=</span> <span class="n">Interface</span><span class="o">.</span><span class="n">ASTMDP</span><span class="p">(</span><span class="n">Simulator</span><span class="p">(;</span> <span class="n">kwargs</span><span class="o">...</span><span class="p">))</span>
    <span class="n">mdp</span><span class="o">.</span><span class="n">rewaan</span><span class="o">.</span><span class="n">event_bonus</span> <span class="o">=</span> <span class="mf">2000.0</span>
    <span class="k">return</span> <span class="n">mdp</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Now using the gray box mdp solver:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">AdaStress</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s">&quot;SoftActorCritic&quot;</span><span class="p">)</span>
<span class="k">using</span> <span class="n">AdaStress</span><span class="o">.</span><span class="n">SoftActorCritic</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sac</span> <span class="o">=</span> <span class="n">SAC</span><span class="p">(;</span>
    <span class="n">obs_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">act_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">gamma</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
    <span class="n">act_mins</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>    <span class="c">#number of standard deviations</span>
    <span class="n">act_maxs</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">hidden_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span>
    <span class="n">num_q</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">max_buffer_size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">update_after</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">update_every</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">steps_per_epoch</span><span class="o">=</span><span class="mi">54</span><span class="p">,</span>
    <span class="n">start_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">max_ep_len</span><span class="o">=</span><span class="mi">54</span><span class="p">,</span>
    <span class="n">num_test_episodes</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">displays</span><span class="o">=</span><span class="p">[(</span><span class="ss">:fails</span><span class="p">,</span> <span class="n">mdp</span> <span class="o">-&gt;</span> <span class="n">mdp</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">mdl</span><span class="o">.</span><span class="n">fxns</span><span class="p">[</span><span class="s">&quot;MoveWater&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">has_fault</span><span class="p">(</span><span class="s">&quot;mech_break&quot;</span><span class="p">)</span> <span class="p">)],</span>
    <span class="n">use_gpu</span><span class="o">=</span><span class="nb">false</span>
<span class="p">)</span>

<span class="n">SoftActorCritic</span><span class="o">.</span><span class="n">ProgressMeter</span><span class="o">.</span><span class="n">ijulia_behavior</span><span class="p">(</span><span class="ss">:clear</span><span class="p">)</span>
<span class="n">ac</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">sac</span><span class="p">(</span><span class="n">mdp_env</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">PyPlot</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&quot;fails&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&quot;score&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ac</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="n">mdlhists3</span> <span class="o">=</span> <span class="kt">Dict</span><span class="p">()</span>
<span class="n">mdp</span> <span class="o">=</span> <span class="n">mdp_env</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="mi">100</span>
    <span class="n">a</span><span class="o">=</span> <span class="n">AdaStress</span><span class="o">.</span><span class="n">replay!</span><span class="p">(</span><span class="n">mdp</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
    <span class="n">mdlhists3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdp</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">log</span>
    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">=</span> <span class="n">AdaStress</span><span class="o">.</span><span class="n">replay!</span><span class="p">(</span><span class="n">mdp</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">fxnflows</span> <span class="o">=</span> <span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;MoveWater&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;eff&quot;</span><span class="p">,</span><span class="s">&quot;total_flow&quot;</span><span class="p">],</span> <span class="s">&quot;Wat_2&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;flowrate&quot;</span><span class="p">,</span><span class="s">&quot;pressure&quot;</span><span class="p">])</span>
<span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">mdlhists</span><span class="p">(</span><span class="n">mdlhists3</span><span class="p">,</span> <span class="n">fxnflowvals</span><span class="o">=</span><span class="n">fxnflows</span><span class="p">,</span> <span class="n">legend_loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">fxnflows</span> <span class="o">=</span> <span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;MoveWater&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;pressure&quot;</span><span class="p">,</span><span class="s">&quot;faults&quot;</span><span class="p">],</span> <span class="s">&quot;Wat_2&quot;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s">&quot;flowrate&quot;</span><span class="p">,</span><span class="s">&quot;pressure&quot;</span><span class="p">])</span>
<span class="n">an</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">mdlhists</span><span class="p">(</span><span class="n">mdlhists3</span><span class="p">,</span> <span class="n">fxnflowvals</span><span class="o">=</span><span class="n">fxnflows</span><span class="p">,</span> <span class="n">legend_loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-julia notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using Parallel Computing in fmdtools &mdash; fmdtools 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/fmdtools_ico.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Defining Nominal Approaches in fmdtools" href="../docs/Nominal_Approach_Use-Cases.html" />
    <link rel="prev" title="Defining Fault Sampling Approaches in fmdtools" href="../docs/Approach_Use-Cases.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/logo_glow.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../README.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../README.html#key-features">Key Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#getting-started">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../README.html#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#contributions">Contributions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../README.html#contributors">Contributors</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../Examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Tutorial_complete.html">fmdtools Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Tutorial_complete.html#1.)-Loading-the-environment-and-model">1.) Loading the environment and model</a></li>
<li class="toctree-l3"><a class="reference internal" href="Tutorial_complete.html#2.)-and-3.)-Simulate-and-visualize-the-results!">2.) and 3.) Simulate and visualize the results!</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Tutorial_complete.html#2a.)-Simulate-nominal">2a.) Simulate nominal</a></li>
<li class="toctree-l4"><a class="reference internal" href="Tutorial_complete.html#2b.)-Visualize-nominal-model">2b.) Visualize nominal model</a></li>
<li class="toctree-l4"><a class="reference internal" href="Tutorial_complete.html#2b.)-Simulate-a-fault-mode">2b.) Simulate a fault mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="Tutorial_complete.html#3b.)-Visualize-fault-model-states">3b.) Visualize fault model states</a></li>
<li class="toctree-l4"><a class="reference internal" href="Tutorial_complete.html#4a.)-Simulate-set-of-fault-modes">4a.) Simulate set of fault modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="Tutorial_complete.html#4b.)-Visualize-set-of-fault-modes">4b.) Visualize set of fault modes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Tutorial_complete.html#5.)-Saving-Work">5.) Saving Work</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../docs/Model_Structure_Visualization_Tutorial.html">Defining and Visualizing fmdtools Model Structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../docs/Model_Structure_Visualization_Tutorial.html#Basics">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/Model_Structure_Visualization_Tutorial.html#Model-Setup">Model Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../docs/Model_Structure_Visualization_Tutorial.html#Graph-Visualization">Graph Visualization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../docs/Model_Structure_Visualization_Tutorial.html#Graph-Views">Graph Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/Model_Structure_Visualization_Tutorial.html#Run-Order">Run Order</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/Model_Structure_Visualization_Tutorial.html#Behavior/Fault-Visualization">Behavior/Fault Visualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../docs/Model_Structure_Visualization_Tutorial.html#Visualizing-time-slices">Visualizing time-slices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../example_multirotor/Demonstration.html">fmdtools Paper Demonstration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../example_multirotor/Demonstration.html#Initial-Model">Initial Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example_multirotor/Demonstration.html#Setting-Node-Positions">Setting Node Positions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example_multirotor/Demonstration.html#Network-Model">Network Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example_multirotor/Demonstration.html#Static-Model">Static Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example_multirotor/Demonstration.html#Dynamic-Model">Dynamic Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example_multirotor/Demonstration.html#Hierarchical-Model">Hierarchical Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../example_multirotor/Demonstration.html#Octocopter-Resilience">Octocopter Resilience</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Pump_Example_Notebook.html">Pump Example Notebook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Pump_Example_Notebook.html#Initial-Model-Checks">Initial Model Checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="Pump_Example_Notebook.html#Tables">Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="Pump_Example_Notebook.html#Propagating-and-Viewing-Results-for-Individual-Faults">Propagating and Viewing Results for Individual Faults</a></li>
<li class="toctree-l3"><a class="reference internal" href="Pump_Example_Notebook.html#Visualization-of-resilience-metrics">Visualization of resilience metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="Pump_Example_Notebook.html#Running-a-List-of-Faults">Running a List of Faults</a></li>
<li class="toctree-l3"><a class="reference internal" href="Pump_Example_Notebook.html#Running-a-Fault-Sampling-Approach">Running a Fault Sampling Approach</a><ul>
<li class="toctree-l4"><a class="reference internal" href="Pump_Example_Notebook.html#Save/Load">Save/Load</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../docs/Approach_Use-Cases.html">Defining Fault Sampling Approaches in fmdtools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../docs/Approach_Use-Cases.html#Basics">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/Approach_Use-Cases.html#Model-Setup">Model Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/Approach_Use-Cases.html#Setting-up-an-approach">Setting up an approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/Approach_Use-Cases.html#Propagating-Faults">Propagating Faults</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../docs/Approach_Use-Cases.html#Time-Sampling-Options">Time Sampling Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../docs/Approach_Use-Cases.html#Pruning">Pruning</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using Parallel Computing in fmdtools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Model-Checks">Model Checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Using-Parallelism-in-Simulation">Using Parallelism in Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Performance-Comparison">Performance Comparison</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Comparison:-No-Histories">Comparison: No Histories</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Comparison:-Many-Faults">Comparison: Many Faults</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Comparison:-Long-simulation">Comparison: Long simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Comparison:-Long-Simulation-No-Tracking">Comparison: Long Simulation No Tracking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Comparison:-Long-Simulation-Only-Necessary-Tracking">Comparison: Long Simulation Only Necessary Tracking</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Comparison:-Lower-Tracking-Time-Resolution">Comparison: Lower Tracking Time Resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Comparison-Conclusions:">Comparison Conclusions:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Further-Computational-Cost-Reduction-via-Profiling">Further Computational Cost Reduction via Profiling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../docs/Nominal_Approach_Use-Cases.html">Defining Nominal Approaches in fmdtools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../docs/Nominal_Approach_Use-Cases.html#Quantifying-probabilities">Quantifying probabilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/Nominal_Approach_Use-Cases.html#Random-input-generation">Random input generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/Nominal_Approach_Use-Cases.html#Nested-Scenario-Sampling">Nested Scenario Sampling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Stochastic_Modelling.html">Stochastic Modelling in fmdtools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Stochastic_Modelling.html#Model-Setup">Model Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="Stochastic_Modelling.html#Simulation-and-Analysis">Simulation and Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Stochastic_Modelling.html#Single-Scenario-Simulation">Single-Scenario Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Stochastic_Modelling.html#Multi-Scenario-Simulation">Multi-Scenario Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Stochastic_Modelling.html#Nested-Fault-Simulation">Nested Fault Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example_tank/Tank_Analysis.html">Hold-up Tank Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../example_tank/Tank_Analysis.html#Verifying-the-nominal-state:">Verifying the nominal state:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example_tank/Tank_Analysis.html#What-happens-under-component-faults?">What happens under component faults?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example_tank/Tank_Analysis.html#What-about-human-induced-faults?">What about human-induced faults?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example_tank/Tank_Analysis.html#Evaluating-Joint-Component-Human-fault-modes">Evaluating Joint Component-Human fault modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example_tank/Tank_Analysis.html#Testing-different-reaction-times">Testing different reaction times</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../example_eps/EPS_Example_Notebook.html">EPS Example Notebook</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../docs/fmdtools.html">Module Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../docs/fmdtools.faultsim.html">fmdtools.faultsim</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../docs/fmdtools.faultsim.html#module-fmdtools.faultsim.networks">fmdtools.faultsim.networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/fmdtools.faultsim.html#fmdtools-faultsim-propagate">fmdtools.faultsim.propagate</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../docs/fmdtools.resultdisp.html">fmdtools.resultdisp package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../docs/fmdtools.resultdisp.html#module-fmdtools.resultdisp.graph">fmdtools.resultdisp.graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/fmdtools.resultdisp.html#module-fmdtools.resultdisp.plot">fmdtools.resultdisp.plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/fmdtools.resultdisp.html#module-fmdtools.resultdisp.process">fmdtools.resultdisp.process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docs/fmdtools.resultdisp.html#module-fmdtools.resultdisp.tabulate">fmdtools.resultdisp.tabulate</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../docs/fmdtools.html#fmdtools-modeldef">fmdtools.modeldef</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">fmdtools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../Examples.html">Examples</a> &raquo;</li>
      <li>Using Parallel Computing in fmdtools</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/example_pump/Parallelism_Tutorial.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Using-Parallel-Computing-in-fmdtools">
<h1>Using Parallel Computing in fmdtools<a class="headerlink" href="#Using-Parallel-Computing-in-fmdtools" title="Permalink to this headline"></a></h1>
<p>This notebook will discuss how to use parallel programming in fmdtools, including: - how to set up a model for parallelism - syntax for using parallelism in simulation functions - considerations for optimizing computational performance in a model</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">ex_pump</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fmdtools.modeldef</span> <span class="kn">import</span> <span class="n">SampleApproach</span>
<span class="kn">import</span> <span class="nn">fmdtools.faultsim.propagate</span> <span class="k">as</span> <span class="nn">propagate</span>
<span class="kn">import</span> <span class="nn">fmdtools.resultdisp</span> <span class="k">as</span> <span class="nn">rd</span>
</pre></div>
</div>
</div>
<p>This notebook uses the pump example (see ex_pump.py) to illustrate the use of parallelism in fmdtools. This is fairly simple model, and thus it should be noted that there may be considerations with more complex models which may not be adequately covered here.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mdl</span> <span class="o">=</span> <span class="n">Pump</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">endresults</span><span class="p">,</span> <span class="n">resgraph</span><span class="p">,</span> <span class="n">mdlhist</span> <span class="o">=</span> <span class="n">propagate</span><span class="o">.</span><span class="n">nominal</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rd</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">resgraph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 432x288 with 1 Axes&gt;, &lt;AxesSubplot:&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_pump_Parallelism_Tutorial_5_1.png" src="../_images/example_pump_Parallelism_Tutorial_5_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rd</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">mdlhistvals</span><span class="p">(</span><span class="n">mdlhist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/example_pump_Parallelism_Tutorial_6_0.png" src="../_images/example_pump_Parallelism_Tutorial_6_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_pump_Parallelism_Tutorial_6_1.png" src="../_images/example_pump_Parallelism_Tutorial_6_1.png" />
</div>
</div>
<section id="Model-Checks">
<h2>Model Checks<a class="headerlink" href="#Model-Checks" title="Permalink to this headline"></a></h2>
<p>Before attempting to leverage parallelism in model execution, it can be helpful to check whether a model is compatible with python parallel computing libraries. In order for a model to be parallelized, it must be compatible with <a class="reference external" href="https://docs.python.org/3/library/pickle.html#:~:text=%E2%80%9CPickling%E2%80%9D%20is%20the%20process%20whereby,back%20into%20an%20object%20hierarchy.">pickling</a>–python’s method of data serialization. This is used in parallel programming methods to copy the model
from the main process thread to the seperate processes of the pool.</p>
<p>fmdtools has two methods to check whether a model can be pickled, <code class="docutils literal notranslate"><span class="pre">check_pickleability</span></code> and <code class="docutils literal notranslate"><span class="pre">check_model_pickleability</span></code>. The main difference between these is that <code class="docutils literal notranslate"><span class="pre">check_pickleability</span></code> works for all objects (e.g. functions and flows), while <code class="docutils literal notranslate"><span class="pre">check_model_pickleability</span></code> gives more information for an overall model structure</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fmdtools.modeldef</span> <span class="kn">import</span> <span class="n">check_pickleability</span><span class="p">,</span> <span class="n">check_model_pickleability</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unpickleable_attributes</span> <span class="o">=</span> <span class="n">check_pickleability</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The object is pickleable
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">check_model_pickleability</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The object is pickleable
</pre></div></div>
</div>
<p>As you can see, this model is pickleable. However, this may not be the case for all structures if they rely on unpickleable data structures. For example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mdl</span><span class="o">.</span><span class="n">fxns</span><span class="p">[</span><span class="s1">&#39;ImportEE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">bad_fxn_attribute</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">flows</span><span class="p">[</span><span class="s1">&#39;EE_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">bad_flow_attribute</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">check_model_pickleability</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The following attributes will not pickle: [&#39;flows&#39;, &#39;fxns&#39;, &#39;graph&#39;]
FLOWS
EE_1
The following attributes will not pickle: [&#39;bad_flow_attribute&#39;]
Sig_1
The object is pickleable
Wat_1
The object is pickleable
Wat_2
The object is pickleable
FUNCTIONS
ImportEE
The following attributes will not pickle: [&#39;flows&#39;, &#39;EEout&#39;, &#39;bad_fxn_attribute&#39;]
ImportWater
The object is pickleable
ImportSignal
The object is pickleable
MoveWater
The following attributes will not pickle: [&#39;flows&#39;, &#39;EEin&#39;]
ExportWater
The object is pickleable
</pre></div></div>
</div>
<p>In this case, because the <code class="docutils literal notranslate"><span class="pre">ImportEE</span></code> function and <code class="docutils literal notranslate"><span class="pre">EE_1</span></code> flow was given a an unpicklable attribute (a <code class="docutils literal notranslate"><span class="pre">dict_keys()</span></code> object) and thus the interfacing functions and overall model will not pickle. To fix this, one could easily convert these attributes into lists, sets, or dictionaries.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mdl</span> <span class="o">=</span> <span class="n">Pump</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Using-Parallelism-in-Simulation">
<h2>Using Parallelism in Simulation<a class="headerlink" href="#Using-Parallelism-in-Simulation" title="Permalink to this headline"></a></h2>
<p>Parallelism generally requires using some external parallel processing toolkit. The syntax used by fmdtools methods is compatible with: - <a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html">multiprocessing</a>, python’s default parallel computing library - <a class="reference external" href="https://pypi.org/project/multiprocess/">multiprocess</a>, a fork of multiprocessing developed by The UQ Foundation - <a class="reference external" href="https://github.com/uqfoundation/pathos">pathos</a>, a broader parallel computing package developed by The UQ Foundation</p>
<p>And any other package that emulates multiprocessing.Pool</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">multiprocess</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="kn">from</span> <span class="nn">pathos.pools</span> <span class="kn">import</span> <span class="n">ParallelPool</span><span class="p">,</span> <span class="n">ProcessPool</span><span class="p">,</span> <span class="n">SerialPool</span><span class="p">,</span> <span class="n">ThreadPool</span>
</pre></div>
</div>
</div>
<p>Parallelism can speed up simulation time when there is a large number of independent simulations to run. The prefered methods for using parallelism are to use a <code class="docutils literal notranslate"><span class="pre">NominalApproach</span></code> or <code class="docutils literal notranslate"><span class="pre">SampleApproach</span></code> with the methods: - propagate.singlefaults (for all single-fault scenarios in a static model with no approach) - propagate.approach (for sampling a set of faults) - propagate.nominal_approach (for simulating the model nominally over a set of parameters) - propagate.nested_approach (for sampling a
set of faults over a set of model parameters)</p>
<p>These methods can be run in parallel by sending them a <code class="docutils literal notranslate"><span class="pre">pool</span></code> object from one of these modules as the optional <code class="docutils literal notranslate"><span class="pre">pool</span></code> argument. Further details on setting up and running an approach are provided in <code class="docutils literal notranslate"><span class="pre">docs/Approach</span> <span class="pre">Use-Cases.ipynb</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">SampleApproach</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
<span class="n">endclasses</span><span class="p">,</span> <span class="n">mdlhists</span> <span class="o">=</span> <span class="n">propagate</span><span class="o">.</span><span class="n">approach</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">app</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
<span class="n">rd</span><span class="o">.</span><span class="n">tabulate</span><span class="o">.</span><span class="n">simplefmea</span><span class="p">(</span><span class="n">endclasses</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
SCENARIOS COMPLETE: 100%|██████████████████████████████████████████████████████████████| 17/17 [00:01&lt;00:00,  9.81it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>cost</th>
      <th>expected cost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ImportEE no_v, t=27</th>
      <td>0.000360</td>
      <td>15175.0</td>
      <td>546300.000000</td>
    </tr>
    <tr>
      <th>ImportEE inf_v, t=27</th>
      <td>0.000090</td>
      <td>20175.0</td>
      <td>181575.000000</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=27</th>
      <td>0.000150</td>
      <td>6175.0</td>
      <td>92625.000000</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=27</th>
      <td>0.000013</td>
      <td>15175.0</td>
      <td>19510.714286</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=27</th>
      <td>0.000231</td>
      <td>10175.0</td>
      <td>235478.571429</td>
    </tr>
    <tr>
      <th>MoveWater short, t=27</th>
      <td>0.000129</td>
      <td>25175.0</td>
      <td>323678.571429</td>
    </tr>
    <tr>
      <th>ExportWater block, t=27</th>
      <td>0.000129</td>
      <td>15152.5</td>
      <td>194817.857143</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=2</th>
      <td>0.000017</td>
      <td>11125.0</td>
      <td>18541.666667</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=2</th>
      <td>0.000002</td>
      <td>20125.0</td>
      <td>4312.500000</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=2</th>
      <td>0.000002</td>
      <td>15125.0</td>
      <td>3241.071429</td>
    </tr>
    <tr>
      <th>MoveWater short, t=2</th>
      <td>0.000021</td>
      <td>30125.0</td>
      <td>64553.571429</td>
    </tr>
    <tr>
      <th>ExportWater block, t=2</th>
      <td>0.000021</td>
      <td>20102.5</td>
      <td>43076.785714</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=52</th>
      <td>0.000017</td>
      <td>1000.0</td>
      <td>1666.666667</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=52</th>
      <td>0.000001</td>
      <td>10000.0</td>
      <td>1428.571429</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=52</th>
      <td>0.000002</td>
      <td>5000.0</td>
      <td>1071.428571</td>
    </tr>
    <tr>
      <th>MoveWater short, t=52</th>
      <td>0.000014</td>
      <td>10000.0</td>
      <td>14285.714286</td>
    </tr>
    <tr>
      <th>ExportWater block, t=52</th>
      <td>0.000014</td>
      <td>5000.0</td>
      <td>7142.857143</td>
    </tr>
    <tr>
      <th>nominal</th>
      <td>1.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">endclasses</span><span class="p">,</span> <span class="n">mdlhists</span> <span class="o">=</span> <span class="n">propagate</span><span class="o">.</span><span class="n">single_faults</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">app</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
<span class="n">rd</span><span class="o">.</span><span class="n">tabulate</span><span class="o">.</span><span class="n">simplefmea</span><span class="p">(</span><span class="n">endclasses</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
SCENARIOS COMPLETE: 100%|██████████████████████████████████████████████████████████████| 21/21 [00:01&lt;00:00, 12.06it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>cost</th>
      <th>expected cost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ImportEE no_v, t=0</th>
      <td>0.000448</td>
      <td>20125.0</td>
      <td>901600.0</td>
    </tr>
    <tr>
      <th>ImportEE inf_v, t=0</th>
      <td>0.000112</td>
      <td>25125.0</td>
      <td>281400.0</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=0</th>
      <td>0.000560</td>
      <td>11125.0</td>
      <td>623000.0</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=0</th>
      <td>0.000056</td>
      <td>20125.0</td>
      <td>112700.0</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=0</th>
      <td>0.000336</td>
      <td>15125.0</td>
      <td>508200.0</td>
    </tr>
    <tr>
      <th>MoveWater short, t=0</th>
      <td>0.000560</td>
      <td>30125.0</td>
      <td>1687000.0</td>
    </tr>
    <tr>
      <th>ExportWater block, t=0</th>
      <td>0.000560</td>
      <td>20102.5</td>
      <td>1125740.0</td>
    </tr>
    <tr>
      <th>ImportEE no_v, t=20</th>
      <td>0.000448</td>
      <td>16750.0</td>
      <td>750400.0</td>
    </tr>
    <tr>
      <th>ImportEE inf_v, t=20</th>
      <td>0.000112</td>
      <td>21750.0</td>
      <td>243600.0</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=20</th>
      <td>0.000560</td>
      <td>7750.0</td>
      <td>434000.0</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=20</th>
      <td>0.000056</td>
      <td>16750.0</td>
      <td>93800.0</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=20</th>
      <td>0.000336</td>
      <td>11750.0</td>
      <td>394800.0</td>
    </tr>
    <tr>
      <th>MoveWater short, t=20</th>
      <td>0.000560</td>
      <td>26750.0</td>
      <td>1498000.0</td>
    </tr>
    <tr>
      <th>ExportWater block, t=20</th>
      <td>0.000560</td>
      <td>16727.5</td>
      <td>936740.0</td>
    </tr>
    <tr>
      <th>ImportEE no_v, t=55</th>
      <td>0.000448</td>
      <td>10000.0</td>
      <td>448000.0</td>
    </tr>
    <tr>
      <th>ImportEE inf_v, t=55</th>
      <td>0.000112</td>
      <td>5000.0</td>
      <td>56000.0</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=55</th>
      <td>0.000560</td>
      <td>1000.0</td>
      <td>56000.0</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=55</th>
      <td>0.000056</td>
      <td>10000.0</td>
      <td>56000.0</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=55</th>
      <td>0.000336</td>
      <td>5000.0</td>
      <td>168000.0</td>
    </tr>
    <tr>
      <th>MoveWater short, t=55</th>
      <td>0.000560</td>
      <td>10000.0</td>
      <td>560000.0</td>
    </tr>
    <tr>
      <th>ExportWater block, t=55</th>
      <td>0.000560</td>
      <td>5000.0</td>
      <td>280000.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>It can also be helpful to verify that the results of parallel simulation and normal serial execution are the same:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">endclasses_par</span><span class="p">,</span> <span class="n">mdlhists</span> <span class="o">=</span> <span class="n">propagate</span><span class="o">.</span><span class="n">single_faults</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
<span class="n">tab_par</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">tabulate</span><span class="o">.</span><span class="n">simplefmea</span><span class="p">(</span><span class="n">endclasses_par</span><span class="p">)</span>
<span class="n">endclasses</span><span class="p">,</span> <span class="n">mdlhists</span> <span class="o">=</span> <span class="n">propagate</span><span class="o">.</span><span class="n">single_faults</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
<span class="n">tab</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">tabulate</span><span class="o">.</span><span class="n">simplefmea</span><span class="p">(</span><span class="n">endclasses</span><span class="p">)</span>
<span class="n">tab</span> <span class="o">-</span> <span class="n">tab_par</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
SCENARIOS COMPLETE: 100%|█████████████████████████████████████████████████████████████| 21/21 [00:00&lt;00:00, 455.48it/s]
SCENARIOS COMPLETE: 100%|█████████████████████████████████████████████████████████████| 21/21 [00:00&lt;00:00, 226.33it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>cost</th>
      <th>expected cost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ImportEE no_v, t=0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportEE inf_v, t=0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater short, t=0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ExportWater block, t=0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportEE no_v, t=20</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportEE inf_v, t=20</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=20</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=20</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=20</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater short, t=20</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ExportWater block, t=20</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportEE no_v, t=55</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportEE inf_v, t=55</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=55</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=55</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=55</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater short, t=55</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ExportWater block, t=55</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">endclasses_par</span><span class="p">,</span> <span class="n">mdlhists</span> <span class="o">=</span> <span class="n">propagate</span><span class="o">.</span><span class="n">approach</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
<span class="n">tab_par</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">tabulate</span><span class="o">.</span><span class="n">simplefmea</span><span class="p">(</span><span class="n">endclasses_par</span><span class="p">)</span>
<span class="n">endclasses</span><span class="p">,</span> <span class="n">mdlhists</span> <span class="o">=</span> <span class="n">propagate</span><span class="o">.</span><span class="n">approach</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
<span class="n">tab</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">tabulate</span><span class="o">.</span><span class="n">simplefmea</span><span class="p">(</span><span class="n">endclasses</span><span class="p">)</span>
<span class="n">tab</span> <span class="o">-</span> <span class="n">tab_par</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
SCENARIOS COMPLETE: 100%|█████████████████████████████████████████████████████████████| 17/17 [00:00&lt;00:00, 485.43it/s]
SCENARIOS COMPLETE: 100%|█████████████████████████████████████████████████████████████| 17/17 [00:00&lt;00:00, 202.92it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>cost</th>
      <th>expected cost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ImportEE no_v, t=27</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportEE inf_v, t=27</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=27</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=27</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=27</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater short, t=27</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ExportWater block, t=27</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater short, t=2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ExportWater block, t=2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportWater no_wat, t=52</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ImportSignal no_sig, t=52</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater mech_break, t=52</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>MoveWater short, t=52</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>ExportWater block, t=52</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>nominal</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>While fmdtools built-in methods are the easiest way to leverage parallelism, it can also be used with custom arguments/methods to meet the needs of simulation. However, (on Windows) these methods need to be defined in an external module with an “if <strong>name</strong>==‘<strong>main</strong>’:” statement, otherwise execution will hang from spawning new processes. This has to do with how multiprocessing works in windows.</p>
<p>To show how parellism can be leveraged manually for a desired use-case, below the model is run over the blockage fault mode at time t=1 with a different model parameter (delayed failure behavior), as defined in the <code class="docutils literal notranslate"><span class="pre">parallelism_methods.py</span></code> module in this folder.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">parallelism_methods</span> <span class="kn">import</span> <span class="n">delay_test</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">delay_test</span><span class="p">()</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
<p>In this method, the model is run many times over a given fault with different delay parameters. It should be noted that this approach is not especially efficient, since the nominal scenario is simulated at each call of <code class="docutils literal notranslate"><span class="pre">propagate.one_fault()</span></code>. It is thus preferred to use the appropriate fault/parameter sampling approaches and propagate methods, since these methods only run the nominal simulation once for fault scenarios and can also use staged execution (copying the model at fault time for
fault scenarios) to reduce ~1/2 of the cost of each fault simulation.</p>
</section>
<section id="Performance-Comparison">
<h2>Performance Comparison<a class="headerlink" href="#Performance-Comparison" title="Permalink to this headline"></a></h2>
<p>Parallelism is often used in computation to speed up up a set of independent simulations. Conventionally, one might say it leads to a reduced computational cost of <span class="math notranslate nohighlight">\(t/n\)</span>, where t was the original time of the set of processes, and n is the number of cores.</p>
<p>However, this computational performance increase is dependent on the implementation. In Python, there is some overhead from from communicating data structures in and out of parallel threads which can become a significant consideration when the data structures are large. Additionally, different Pools can execute more or less efficiently. Below these are each compared.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">parallelism_methods</span> <span class="kn">import</span> <span class="n">compare_pools</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cores</span><span class="o">=</span><span class="mi">4</span>
<span class="n">pools</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;multiprocessing&#39;</span><span class="p">:</span><span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">cores</span><span class="p">),</span> <span class="s1">&#39;ProcessPool&#39;</span><span class="p">:</span><span class="n">ProcessPool</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">cores</span><span class="p">),</span> <span class="s1">&#39;ParallelPool&#39;</span><span class="p">:</span> <span class="n">ParallelPool</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">cores</span><span class="p">),</span> <span class="s1">&#39;ThreadPool&#39;</span><span class="p">:</span><span class="n">ThreadPool</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">cores</span><span class="p">),</span> <span class="s1">&#39;multiprocess&#39;</span><span class="p">:</span><span class="n">ms</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">cores</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<p>Below is the baseline comparison, where the the following parameters characterize the sampling approach: - single faults: only the single-fault scenarios are considered - 3 points per phase: an evenly-spaced quadrature is sampled at each phase of operation (start, on, end) for the model - staged: the model is copied at each point in time where faults is injected during the model time to save computation - track: the entire model history is returned for each simulation</p>
<p>This is typical for a small model like this where the per-model expense is low.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">SampleApproach</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">jointfaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;faults&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="n">defaultsamp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;samp&#39;</span><span class="p">:</span><span class="s1">&#39;evenspacing&#39;</span><span class="p">,</span><span class="s1">&#39;numpts&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">mdl</span><span class="o">=</span><span class="n">Pump</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cost&#39;</span><span class="p">:{</span><span class="s1">&#39;repair&#39;</span><span class="p">},</span> <span class="s1">&#39;delay&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="n">modelparams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;phases&#39;</span><span class="p">:{</span><span class="s1">&#39;start&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;on&#39;</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;end&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span><span class="mi">55</span><span class="p">]},</span> <span class="s1">&#39;times&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">55</span><span class="p">],</span> <span class="s1">&#39;tstep&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">exectimes</span> <span class="o">=</span> <span class="n">compare_pools</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">app</span><span class="p">,</span><span class="n">pools</span><span class="p">,</span> <span class="n">staged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">exectimes_baseline</span> <span class="o">=</span> <span class="n">exectimes</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Baseline Performance - Some faults, Staged, Normal Simulation, Full Model History&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Computational Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_pump_Parallelism_Tutorial_34_0.png" src="../_images/example_pump_Parallelism_Tutorial_34_0.png" />
</div>
</div>
<p>As shown, in this situation, both the multiprocessing and threadpool pools give computational performance increases.</p>
<section id="Comparison:-No-Histories">
<h3>Comparison: No Histories<a class="headerlink" href="#Comparison:-No-Histories" title="Permalink to this headline"></a></h3>
<p>In the below comparison, the same simulation approach is run, except without tracking a history of model states through the simulation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">SampleApproach</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">jointfaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;faults&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="n">defaultsamp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;samp&#39;</span><span class="p">:</span><span class="s1">&#39;evenspacing&#39;</span><span class="p">,</span><span class="s1">&#39;numpts&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">mdl</span><span class="o">=</span><span class="n">Pump</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cost&#39;</span><span class="p">:{</span><span class="s1">&#39;repair&#39;</span><span class="p">},</span> <span class="s1">&#39;delay&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="n">modelparams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;phases&#39;</span><span class="p">:{</span><span class="s1">&#39;start&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;on&#39;</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;end&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span><span class="mi">55</span><span class="p">]},</span> <span class="s1">&#39;times&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">55</span><span class="p">],</span> <span class="s1">&#39;tstep&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">exectimes</span> <span class="o">=</span> <span class="n">compare_pools</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">app</span><span class="p">,</span><span class="n">pools</span><span class="p">,</span> <span class="n">staged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),)</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;comparison&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Computational Performance - Many Faults, Staged, Normal Simulation, No Model History&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Computational Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x19d34b19130&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_pump_Parallelism_Tutorial_38_1.png" src="../_images/example_pump_Parallelism_Tutorial_38_1.png" />
</div>
</div>
<p>As shown, in this situation, the overall simulation expense decreases dramatically (~1/2), even in the serial execution case.</p>
<p>Additionally, the case for using a parallel processing pool increases immensely (the multiprocessing pool takes ~1/4 of the normal simulation time). This is because passing the model history back to the main process is nearly comparable in time to simulation itself.</p>
<p>As a result, removing it saves a large amount of computational time when using parallel processing.</p>
</section>
<section id="Comparison:-Many-Faults">
<h3>Comparison: Many Faults<a class="headerlink" href="#Comparison:-Many-Faults" title="Permalink to this headline"></a></h3>
<p>In the below comparison, many faults are injected in the system to increase the number of scenarios (ostensibly making the case better for parallelism)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">SampleApproach</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">jointfaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;faults&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">},</span><span class="n">defaultsamp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;samp&#39;</span><span class="p">:</span><span class="s1">&#39;evenspacing&#39;</span><span class="p">,</span><span class="s1">&#39;numpts&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">mdl</span><span class="o">=</span><span class="n">Pump</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cost&#39;</span><span class="p">:{</span><span class="s1">&#39;repair&#39;</span><span class="p">},</span> <span class="s1">&#39;delay&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="n">modelparams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;phases&#39;</span><span class="p">:{</span><span class="s1">&#39;start&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;on&#39;</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;end&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span><span class="mi">55</span><span class="p">]},</span> <span class="s1">&#39;times&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">55</span><span class="p">],</span> <span class="s1">&#39;tstep&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">exectimes</span> <span class="o">=</span> <span class="n">compare_pools</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">app</span><span class="p">,</span><span class="n">pools</span><span class="p">,</span> <span class="n">staged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\dhulse\Documents\GitHub\fmdtools\example_pump\..\fmdtools\modeldef.py:1879: RuntimeWarning: invalid value encountered in double_scalars
  if len(overlap)&gt;1:  self.rates_timeless[jointmode][phaseid] = self.rates[jointmode][phaseid]/(overlap[1]-overlap[0])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),)</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;comparison&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Computational Performance - Many Faults, Staged, Normal Simulation, Full Model History&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Computational Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x19d34b13f70&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_pump_Parallelism_Tutorial_42_1.png" src="../_images/example_pump_Parallelism_Tutorial_42_1.png" />
</div>
</div>
<p>As shown, increasing the number of joint-fault scenarios increases computational costs significantly–as would be expected.</p>
<p>In this situation, multiprocessing performs comparatively better, but only slightly–instead of taking 1/4 the time, it only takes about 1/2 the time.</p>
</section>
<section id="Comparison:-Long-simulation">
<h3>Comparison: Long simulation<a class="headerlink" href="#Comparison:-Long-simulation" title="Permalink to this headline"></a></h3>
<p>It may be of interest to simulate how the comparative performance changes for longer simulations. In this comparison, the simulation time is extended tenfold.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">SampleApproach</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">jointfaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;faults&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="n">defaultsamp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;samp&#39;</span><span class="p">:</span><span class="s1">&#39;evenspacing&#39;</span><span class="p">,</span><span class="s1">&#39;numpts&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">mdl</span><span class="o">=</span><span class="n">Pump</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cost&#39;</span><span class="p">:{</span><span class="s1">&#39;repair&#39;</span><span class="p">},</span> <span class="s1">&#39;delay&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="n">modelparams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;phases&#39;</span><span class="p">:{</span><span class="s1">&#39;start&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;on&#39;</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;end&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span><span class="mi">500</span><span class="p">]},</span> <span class="s1">&#39;times&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span> <span class="s1">&#39;tstep&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">exectimes</span> <span class="o">=</span> <span class="n">compare_pools</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">app</span><span class="p">,</span><span class="n">pools</span><span class="p">,</span> <span class="n">staged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),)</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;comparison&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Computational Performance - Normal Faults, Staged, Long Simulation, Full Model History&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Computational Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x19d34cd40a0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_pump_Parallelism_Tutorial_46_1.png" src="../_images/example_pump_Parallelism_Tutorial_46_1.png" />
</div>
</div>
<p>As shown, the simulation time does increase significantly–about tenfold. In terms of comparative performance, the same general trends hold, except some pools take more of a performance decrease than others. Ostensibly because they require more computational overhead to copy larger data structures back to the main process.</p>
</section>
<section id="Comparison:-Long-Simulation-No-Tracking">
<h3>Comparison: Long Simulation No Tracking<a class="headerlink" href="#Comparison:-Long-Simulation-No-Tracking" title="Permalink to this headline"></a></h3>
<p>Finally, it may be interesting to see how performance is affected in long simulations when there is no tracking. This is because in these simulations, there should be very little overhead from creating the respective data structures, even when there is a long simulation. This comparison is shown below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">SampleApproach</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">jointfaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;faults&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="n">defaultsamp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;samp&#39;</span><span class="p">:</span><span class="s1">&#39;evenspacing&#39;</span><span class="p">,</span><span class="s1">&#39;numpts&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">mdl</span><span class="o">=</span><span class="n">Pump</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cost&#39;</span><span class="p">:{</span><span class="s1">&#39;repair&#39;</span><span class="p">},</span> <span class="s1">&#39;delay&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="n">modelparams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;phases&#39;</span><span class="p">:{</span><span class="s1">&#39;start&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;on&#39;</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;end&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span><span class="mi">500</span><span class="p">]},</span> <span class="s1">&#39;times&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span> <span class="s1">&#39;tstep&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">exectimes</span> <span class="o">=</span> <span class="n">compare_pools</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">app</span><span class="p">,</span><span class="n">pools</span><span class="p">,</span> <span class="n">staged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),)</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;comparison&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Computational Performance - Normal Faults, Staged, Long Simulation, No Model History&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Computational Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x19d34d0deb0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_pump_Parallelism_Tutorial_50_1.png" src="../_images/example_pump_Parallelism_Tutorial_50_1.png" />
</div>
</div>
<p>As shown, with a long simulation, the case for pools (other than multiprocessing–ProcessPool, ParallelPool, multiprocess) increases somewhat.</p>
</section>
<section id="Comparison:-Long-Simulation-Only-Necessary-Tracking">
<h3>Comparison: Long Simulation Only Necessary Tracking<a class="headerlink" href="#Comparison:-Long-Simulation-Only-Necessary-Tracking" title="Permalink to this headline"></a></h3>
<p>In practice, it can be necessary to track some states over time. Here we perform the same comparison using the ‘valstates’ option, which only tracks states which have been defined in the model to be necessary to track (using ‘valparams’)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">SampleApproach</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">jointfaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;faults&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="n">defaultsamp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;samp&#39;</span><span class="p">:</span><span class="s1">&#39;evenspacing&#39;</span><span class="p">,</span><span class="s1">&#39;numpts&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">mdl</span><span class="o">=</span><span class="n">Pump</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cost&#39;</span><span class="p">:{</span><span class="s1">&#39;repair&#39;</span><span class="p">},</span> <span class="s1">&#39;delay&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="n">modelparams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;phases&#39;</span><span class="p">:{</span><span class="s1">&#39;start&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;on&#39;</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;end&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span><span class="mi">500</span><span class="p">]},</span> <span class="s1">&#39;times&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span> <span class="s1">&#39;tstep&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">exectimes</span> <span class="o">=</span> <span class="n">compare_pools</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">app</span><span class="p">,</span><span class="n">pools</span><span class="p">,</span> <span class="n">staged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track</span><span class="o">=</span><span class="s1">&#39;valparams&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),)</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;comparison&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Computational Performance - Normal Faults, Staged, Long Simulation, Only Necessary History&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Computational Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x19d35fbc340&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_pump_Parallelism_Tutorial_54_1.png" src="../_images/example_pump_Parallelism_Tutorial_54_1.png" />
</div>
</div>
<p>As shown, even though this model has a large increase in simulation time, the this time can be reduced by not returning the full history.</p>
<p>Thus, the major computational performance limitation in this model is not necessarily the model, but the generation, update, and passing of the history itself.</p>
</section>
</section>
<section id="Comparison:-Lower-Tracking-Time-Resolution">
<h2>Comparison: Lower Tracking Time Resolution<a class="headerlink" href="#Comparison:-Lower-Tracking-Time-Resolution" title="Permalink to this headline"></a></h2>
<p>Finally, the number of recorded timesteps can be lowered to lower computational costs while still returning all relevant variables.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">SampleApproach</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">jointfaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;faults&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="n">defaultsamp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;samp&#39;</span><span class="p">:</span><span class="s1">&#39;evenspacing&#39;</span><span class="p">,</span><span class="s1">&#39;numpts&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">mdl</span><span class="o">=</span><span class="n">Pump</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cost&#39;</span><span class="p">:{</span><span class="s1">&#39;repair&#39;</span><span class="p">},</span> <span class="s1">&#39;delay&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="n">modelparams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;phases&#39;</span><span class="p">:{</span><span class="s1">&#39;start&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;on&#39;</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;end&#39;</span><span class="p">:[</span><span class="mi">50</span><span class="p">,</span><span class="mi">500</span><span class="p">]},</span> <span class="s1">&#39;times&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="mi">55</span><span class="p">],</span> <span class="s1">&#39;tstep&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
<span class="n">exectimes</span> <span class="o">=</span> <span class="n">compare_pools</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span><span class="n">app</span><span class="p">,</span><span class="n">pools</span><span class="p">,</span> <span class="n">staged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">track_times</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),)</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;comparison&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes_baseline</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exectimes</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="n">exectimes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Computational Performance - Many Faults, Staged, Normal Simulation, No Model History&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Computational Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x19d35fed670&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_pump_Parallelism_Tutorial_58_1.png" src="../_images/example_pump_Parallelism_Tutorial_58_1.png" />
</div>
</div>
<p>As shown, while lowering time resolution could theoretically lower computational time, it does not significantly change much in this example.</p>
</section>
<section id="Comparison-Conclusions:">
<h2>Comparison Conclusions:<a class="headerlink" href="#Comparison-Conclusions:" title="Permalink to this headline"></a></h2>
<p>Parallelism can the improve computational performance of a given resilience simulation approach. However, this improvement is dependent on the parameters of the simulation. Generally, the official python <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> module seems to be the only package that consistently gives a performance improvement over a single-process execution, although this can change depending on the underlying model and modelling approach. There are additionally reasons you might choose other pools–<code class="docutils literal notranslate"><span class="pre">Pathos</span></code> and
<code class="docutils literal notranslate"><span class="pre">multiprocess</span></code> pools may enable more data structures in the model because they extend what can be communicated in and out of threads.</p>
<p>In general, one of the major considerations for optimization compuational time is not just the <em>simulation of the model</em>, but the <em>size of the returned data structures</em>. Minimizing the size of the returned data structures can reduce computational time both by reducing the time of an individual simulation and by reducing the <em>parallelism overhead</em> from copying these data structures in and out of parallel threads. However, it is important to recognize that for resilience assessment, one often
needs a history of model states (or, at least, states of interest) to properly quantify the dynamic costs (i.e., <span class="math notranslate nohighlight">\(\int C_f(t) dt\)</span>). Indeed, in this model, only repair costs were able to be used in the comparison of non-tracked states, because the other dynamic costs required a history of their corresponding flows. Changing the number and size of tracked model states can influence the computational time, but only to a point–while one would expect lowering time-fidelity to have a significant
effect, it does not because the overhead is less to do with filling the underlying data structures as it has to do with instantiating and returning them–a far more effective method is to only return the functions/flows which are needed by the model.</p>
</section>
<section id="Further-Computational-Cost-Reduction-via-Profiling">
<h2>Further Computational Cost Reduction via Profiling<a class="headerlink" href="#Further-Computational-Cost-Reduction-via-Profiling" title="Permalink to this headline"></a></h2>
<p>While parallelism and staged execution are helpful and relatively easy-to-implement methods of computational cost reduction, it can be helpful (especially for more complex models) to see what aspects of the model are taking the most computational time.</p>
<p>Python’s builtin <code class="docutils literal notranslate"><span class="pre">cProfile</span></code> package can ge used to see the relative computational times of different functions/processes.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cProfile</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cProfile</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;propagate.nominal(mdl)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
         17261 function calls in 0.011 seconds

   Ordered by: standard name

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.000    0.000    0.000    0.000 &lt;__array_function__ internals&gt;:2(amin)
      672    0.000    0.000    0.001    0.000 &lt;__array_function__ internals&gt;:2(can_cast)
       12    0.000    0.000    0.000    0.000 &lt;__array_function__ internals&gt;:2(concatenate)
       12    0.000    0.000    0.000    0.000 &lt;__array_function__ internals&gt;:2(copyto)
        1    0.000    0.000    0.011    0.011 &lt;string&gt;:1(&lt;module&gt;)
       12    0.000    0.000    0.000    0.000 _asarray.py:23(asarray)
      114    0.000    0.000    0.001    0.000 _collections_abc.py:706(__ior__)
       48    0.000    0.000    0.000    0.000 _collections_abc.py:779(items)
       48    0.000    0.000    0.000    0.000 _collections_abc.py:802(__init__)
      108    0.000    0.000    0.000    0.000 _collections_abc.py:849(__iter__)
       24    0.000    0.000    0.000    0.000 _ufunc_config.py:132(geterr)
       24    0.000    0.000    0.000    0.000 _ufunc_config.py:32(seterr)
       12    0.000    0.000    0.000    0.000 _ufunc_config.py:433(__enter__)
       12    0.000    0.000    0.000    0.000 _ufunc_config.py:438(__exit__)
       12    0.000    0.000    0.000    0.000 abc.py:117(__instancecheck__)
       12    0.000    0.000    0.000    0.000 contextlib.py:63(_recreate_cm)
       12    0.000    0.000    0.000    0.000 contextlib.py:76(inner)
       28    0.000    0.000    0.000    0.000 coreviews.py:268(__init__)
       12    0.000    0.000    0.000    0.000 coreviews.py:275(__iter__)
       24    0.000    0.000    0.000    0.000 coreviews.py:282(&lt;genexpr&gt;)
       12    0.000    0.000    0.000    0.000 coreviews.py:284(__getitem__)
       28    0.000    0.000    0.000    0.000 coreviews.py:316(__init__)
       12    0.000    0.000    0.000    0.000 coreviews.py:324(__iter__)
       36    0.000    0.000    0.000    0.000 coreviews.py:330(&lt;genexpr&gt;)
       48    0.000    0.000    0.000    0.000 coreviews.py:383(__iter__)
       48    0.000    0.000    0.000    0.000 coreviews.py:391(&lt;genexpr&gt;)
       24    0.000    0.000    0.000    0.000 coreviews.py:401(__getitem__)
       24    0.000    0.000    0.000    0.000 coreviews.py:404(new_node_ok)
       24    0.000    0.000    0.000    0.000 coreviews.py:439(__getitem__)
       92    0.000    0.000    0.000    0.000 coreviews.py:44(__init__)
       48    0.000    0.000    0.000    0.000 coreviews.py:442(edge_ok)
       42    0.000    0.000    0.000    0.000 coreviews.py:50(__iter__)
        4    0.000    0.000    0.000    0.000 coreviews.py:53(__getitem__)
       46    0.000    0.000    0.000    0.000 coreviews.py:81(__getitem__)
       59    0.000    0.000    0.000    0.000 ex_pump.py:107(behavior)
        1    0.000    0.000    0.000    0.000 ex_pump.py:114(__init__)
       59    0.000    0.000    0.000    0.000 ex_pump.py:119(behavior)
        1    0.000    0.000    0.000    0.000 ex_pump.py:125(__init__)
       59    0.000    0.000    0.000    0.000 ex_pump.py:130(behavior)
        1    0.000    0.000    0.000    0.000 ex_pump.py:144(__init__)
       61    0.000    0.000    0.000    0.000 ex_pump.py:158(condfaults)
       60    0.000    0.000    0.000    0.000 ex_pump.py:171(behavior)
        2    0.000    0.000    0.000    0.000 ex_pump.py:199(__init__)
        1    0.000    0.000    0.002    0.002 ex_pump.py:214(__init__)
        1    0.000    0.000    0.000    0.000 ex_pump.py:259(find_classification)
        1    0.000    0.000    0.000    0.000 ex_pump.py:49(__init__)
       60    0.000    0.000    0.000    0.000 ex_pump.py:79(condfaults)
       59    0.000    0.000    0.000    0.000 ex_pump.py:87(behavior)
        1    0.000    0.000    0.000    0.000 ex_pump.py:99(__init__)
       48    0.000    0.000    0.000    0.000 filters.py:20(no_filter)
        4    0.000    0.000    0.000    0.000 filters.py:51(__init__)
      156    0.000    0.000    0.000    0.000 filters.py:54(__call__)
        1    0.000    0.000    0.000    0.000 fromnumeric.py:2737(_amin_dispatcher)
        1    0.000    0.000    0.000    0.000 fromnumeric.py:2742(amin)
        1    0.000    0.000    0.000    0.000 fromnumeric.py:70(_wrapreduction)
        1    0.000    0.000    0.000    0.000 fromnumeric.py:71(&lt;dictcomp&gt;)
        4    0.000    0.000    0.000    0.000 function.py:161(freeze)
        4    0.000    0.000    0.000    0.000 function.py:590(set_node_attributes)
        1    0.000    0.000    0.000    0.000 function.py:715(set_edge_attributes)
        5    0.000    0.000    0.000    0.000 getlimits.py:514(__init__)
        5    0.000    0.000    0.000    0.000 getlimits.py:538(max)
       16    0.000    0.000    0.000    0.000 graph.py:1214(neighbors)
        1    0.000    0.000    0.000    0.000 graph.py:1257(edges)
        1    0.000    0.000    0.000    0.000 graph.py:1380(degree)
        3    0.000    0.000    0.000    0.000 graph.py:1454(is_multigraph)
        2    0.000    0.000    0.000    0.000 graph.py:1458(is_directed)
        1    0.000    0.000    0.000    0.000 graph.py:1462(copy)
       10    0.000    0.000    0.000    0.000 graph.py:1543(&lt;genexpr&gt;)
       17    0.000    0.000    0.000    0.000 graph.py:1544(&lt;genexpr&gt;)
        4    0.000    0.000    0.000    0.000 graph.py:1664(subgraph)
        4    0.000    0.000    0.000    0.000 graph.py:1863(nbunch_iter)
       12    0.000    0.000    0.000    0.000 graph.py:1909(bunch_iter)
        8    0.000    0.000    0.000    0.000 graph.py:289(__init__)
       46    0.000    0.000    0.000    0.000 graph.py:338(adj)
        4    0.000    0.000    0.000    0.000 graph.py:416(__contains__)
       46    0.000    0.000    0.000    0.000 graph.py:452(__getitem__)
        5    0.000    0.000    0.000    0.000 graph.py:526(add_nodes_from)
       29    0.000    0.000    0.000    0.000 graph.py:661(nodes)
        7    0.000    0.000    0.000    0.000 graph.py:895(add_edges_from)
        4    0.000    0.000    0.000    0.000 graphviews.py:75(subgraph_view)
        1    0.000    0.000    0.000    0.000 isolate.py:40(isolates)
        1    0.000    0.000    0.000    0.000 isolate.py:82(&lt;genexpr&gt;)
        1    0.000    0.000    0.001    0.001 modeldef.py:1008(build_model)
        1    0.000    0.000    0.000    0.000 modeldef.py:1023(&lt;listcomp&gt;)
        1    0.000    0.000    0.000    0.000 modeldef.py:1024(&lt;listcomp&gt;)
        1    0.000    0.000    0.000    0.000 modeldef.py:1026(&lt;listcomp&gt;)
        1    0.000    0.000    0.001    0.001 modeldef.py:1027(construct_graph)
        1    0.000    0.000    0.000    0.000 modeldef.py:1041(&lt;listcomp&gt;)
        4    0.000    0.000    0.000    0.000 modeldef.py:1050(&lt;listcomp&gt;)
        1    0.000    0.000    0.000    0.000 modeldef.py:1110(return_stategraph)
        1    0.000    0.000    0.000    0.000 modeldef.py:1179(calc_repaircost)
        1    0.000    0.000    0.000    0.000 modeldef.py:1201(&lt;listcomp&gt;)
        2    0.000    0.000    0.000    0.000 modeldef.py:1204(return_faultmodes)
       10    0.000    0.000    0.000    0.000 modeldef.py:1217(&lt;listcomp&gt;)
        1    0.000    0.000    0.000    0.000 modeldef.py:1252(reset)
        1    0.000    0.000    0.000    0.000 modeldef.py:1276(__init__)
        1    0.000    0.000    0.000    0.000 modeldef.py:1300(reset)
        5    0.000    0.000    0.000    0.000 modeldef.py:155(__init__)
        5    0.000    0.000    0.000    0.000 modeldef.py:342(assoc_modes)
      415    0.000    0.000    0.000    0.000 modeldef.py:465(has_fault)
      301    0.000    0.000    0.000    0.000 modeldef.py:497(add_fault)
        5    0.000    0.000    0.000    0.000 modeldef.py:553(reset)
      882    0.001    0.000    0.001    0.000 modeldef.py:571(return_states)
        5    0.000    0.000    0.000    0.000 modeldef.py:605(__init__)
        5    0.000    0.000    0.000    0.000 modeldef.py:641(make_flowdict)
      301    0.001    0.000    0.002    0.000 modeldef.py:721(updatefxn)
        4    0.000    0.000    0.000    0.000 modeldef.py:790(__init__)
        4    0.000    0.000    0.000    0.000 modeldef.py:811(reset)
      712    0.000    0.000    0.001    0.000 modeldef.py:815(status)
        1    0.000    0.000    0.000    0.000 modeldef.py:876(__init__)
        4    0.000    0.000    0.000    0.000 modeldef.py:931(add_flow)
        5    0.000    0.000    0.001    0.000 modeldef.py:951(add_fxn)
        5    0.000    0.000    0.000    0.000 modeldef.py:985(get_flows)
        5    0.000    0.000    0.000    0.000 modeldef.py:987(&lt;listcomp&gt;)
       12    0.000    0.000    0.000    0.000 multiarray.py:1054(copyto)
       12    0.000    0.000    0.000    0.000 multiarray.py:143(concatenate)
      672    0.000    0.000    0.000    0.000 multiarray.py:478(can_cast)
        5    0.000    0.000    0.000    0.000 multigraph.py:291(__init__)
        4    0.000    0.000    0.000    0.000 multigraph.py:403(add_edge)
        8    0.000    0.000    0.000    0.000 multigraph.py:686(has_edge)
        4    0.000    0.000    0.000    0.000 multigraph.py:742(edges)
        4    0.000    0.000    0.000    0.000 multigraph.py:915(is_multigraph)
        4    0.000    0.000    0.000    0.000 multigraph.py:919(is_directed)
       12    0.000    0.000    0.000    0.000 numeric.py:288(full)
       56    0.000    0.000    0.001    0.000 ordered_set.py:122(copy)
       32    0.000    0.000    0.000    0.000 ordered_set.py:157(__contains__)
      290    0.000    0.000    0.000    0.000 ordered_set.py:169(add)
        5    0.000    0.000    0.000    0.000 ordered_set.py:190(update)
      224    0.000    0.000    0.000    0.000 ordered_set.py:287(__iter__)
       56    0.000    0.000    0.000    0.000 ordered_set.py:336(union)
      115    0.000    0.000    0.001    0.000 ordered_set.py:65(__init__)
      280    0.000    0.000    0.000    0.000 ordered_set.py:71(__len__)
       12    0.000    0.000    0.000    0.000 projection.py:101(&lt;genexpr&gt;)
       10    0.000    0.000    0.000    0.000 projection.py:103(&lt;setcomp&gt;)
       13    0.000    0.000    0.000    0.000 projection.py:114(&lt;genexpr&gt;)
        2    0.000    0.000    0.000    0.000 projection.py:15(projected_graph)
        1    0.000    0.000    0.000    0.000 propagate.py:1021(init_fxnhist)
        5    0.000    0.000    0.000    0.000 propagate.py:1044(&lt;listcomp&gt;)
        5    0.000    0.000    0.000    0.000 propagate.py:1047(&lt;dictcomp&gt;)
        7    0.000    0.000    0.000    0.000 propagate.py:1047(&lt;listcomp&gt;)
        1    0.000    0.000    0.000    0.000 propagate.py:111(new_mdl_params)
        1    0.000    0.000    0.011    0.011 propagate.py:36(nominal)
        1    0.000    0.000    0.000    0.000 propagate.py:629(construct_nomscen)
        1    0.000    0.000    0.009    0.009 propagate.py:685(prop_one_scen)
       56    0.000    0.000    0.005    0.000 propagate.py:775(propagate)
       56    0.001    0.000    0.004    0.000 propagate.py:803(prop_time)
       12    0.000    0.000    0.000    0.000 propagate.py:841(&lt;listcomp&gt;)
       56    0.000    0.000    0.003    0.000 propagate.py:856(update_mdlhist)
       56    0.001    0.000    0.002    0.000 propagate.py:880(update_flowhist)
       56    0.000    0.000    0.001    0.000 propagate.py:903(update_fxnhist)
        3    0.000    0.000    0.000    0.000 propagate.py:92(update_params)
        1    0.000    0.000    0.000    0.000 propagate.py:930(cut_mdlhist)
        1    0.000    0.000    0.000    0.000 propagate.py:960(init_mdlhist)
        1    0.000    0.000    0.000    0.000 propagate.py:992(&lt;listcomp&gt;)
        1    0.000    0.000    0.000    0.000 propagate.py:994(init_flowhist)
        5    0.000    0.000    0.000    0.000 reportviews.py:1003(__init__)
        5    0.000    0.000    0.000    0.000 reportviews.py:1132(__iter__)
        8    0.000    0.000    0.000    0.000 reportviews.py:1247(__len__)
       16    0.000    0.000    0.000    0.000 reportviews.py:1248(&lt;genexpr&gt;)
       24    0.000    0.000    0.000    0.000 reportviews.py:1250(__iter__)
       29    0.000    0.000    0.000    0.000 reportviews.py:177(__init__)
       29    0.000    0.000    0.000    0.000 reportviews.py:187(__getitem__)
        1    0.000    0.000    0.000    0.000 reportviews.py:355(__init__)
        1    0.000    0.000    0.000    0.000 reportviews.py:362(__call__)
       10    0.000    0.000    0.000    0.000 reportviews.py:465(__iter__)
        5    0.000    0.000    0.000    0.000 {built-in method __new__ of type object at 0x00007FFC5FBB3C60}
       12    0.000    0.000    0.000    0.000 {built-in method _abc._abc_instancecheck}
      420    0.000    0.000    0.000    0.000 {built-in method builtins.any}
        1    0.000    0.000    0.011    0.011 {built-in method builtins.exec}
     2203    0.000    0.000    0.000    0.000 {built-in method builtins.getattr}
     1281    0.000    0.000    0.000    0.000 {built-in method builtins.hasattr}
       92    0.000    0.000    0.000    0.000 {built-in method builtins.isinstance}
      282    0.000    0.000    0.000    0.000 {built-in method builtins.iter}
     1021    0.000    0.000    0.000    0.000 {built-in method builtins.len}
        5    0.000    0.000    0.000    0.000 {built-in method builtins.max}
      180    0.000    0.000    0.000    0.000 {built-in method builtins.min}
       33    0.000    0.000    0.000    0.000 {built-in method builtins.setattr}
        9    0.000    0.000    0.000    0.000 {built-in method builtins.sum}
       56    0.000    0.000    0.000    0.000 {built-in method from_iterable}
       14    0.000    0.000    0.000    0.000 {built-in method fromkeys}
        1    0.000    0.000    0.000    0.000 {built-in method numpy.arange}
       20    0.000    0.000    0.000    0.000 {built-in method numpy.array}
      697    0.001    0.000    0.001    0.000 {built-in method numpy.core._multiarray_umath.implement_array_function}
       12    0.000    0.000    0.000    0.000 {built-in method numpy.empty}
       48    0.000    0.000    0.000    0.000 {built-in method numpy.geterrobj}
       24    0.000    0.000    0.000    0.000 {built-in method numpy.seterrobj}
       12    0.000    0.000    0.000    0.000 {function SeedSequence.generate_state at 0x0000019D2E712B80}
        5    0.000    0.000    0.000    0.000 {method &#39;add&#39; of &#39;set&#39; objects}
      298    0.000    0.000    0.000    0.000 {method &#39;append&#39; of &#39;list&#39; objects}
       65    0.000    0.000    0.000    0.000 {method &#39;clear&#39; of &#39;set&#39; objects}
       54    0.000    0.000    0.000    0.000 {method &#39;copy&#39; of &#39;dict&#39; objects}
       60    0.000    0.000    0.000    0.000 {method &#39;copy&#39; of &#39;list&#39; objects}
      952    0.000    0.000    0.000    0.000 {method &#39;copy&#39; of &#39;set&#39; objects}
      301    0.000    0.000    0.000    0.000 {method &#39;difference&#39; of &#39;set&#39; objects}
        1    0.000    0.000    0.000    0.000 {method &#39;disable&#39; of &#39;_lsprof.Profiler&#39; objects}
       48    0.000    0.000    0.000    0.000 {method &#39;get&#39; of &#39;dict&#39; objects}
        5    0.000    0.000    0.000    0.000 {method &#39;integers&#39; of &#39;numpy.random._generator.Generator&#39; objects}
      415    0.000    0.000    0.000    0.000 {method &#39;intersection&#39; of &#39;set&#39; objects}
      546    0.000    0.000    0.000    0.000 {method &#39;items&#39; of &#39;dict&#39; objects}
       85    0.000    0.000    0.000    0.000 {method &#39;keys&#39; of &#39;dict&#39; objects}
        1    0.000    0.000    0.000    0.000 {method &#39;reduce&#39; of &#39;numpy.ufunc&#39; objects}
      130    0.000    0.000    0.000    0.000 {method &#39;update&#39; of &#39;dict&#39; objects}
      313    0.000    0.000    0.000    0.000 {method &#39;update&#39; of &#39;set&#39; objects}
        2    0.000    0.000    0.000    0.000 {method &#39;values&#39; of &#39;dict&#39; objects}
       12    0.000    0.000    0.001    0.000 {numpy.random._generator.default_rng}


</pre></div></div>
</div>
<p>This is difficult to vizualize, although there are methods to store and sort through this output if needed. The <code class="docutils literal notranslate"><span class="pre">pycallgraph</span></code> package (requires a graphviz installation) can give a more immediate and insightful picture of where the code bottlenecks are.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pycallgraph2</span> <span class="kn">import</span> <span class="n">PyCallGraph</span>
<span class="kn">from</span> <span class="nn">pycallgraph2.output</span> <span class="kn">import</span> <span class="n">GraphvizOutput</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">PyCallGraph</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">GraphvizOutput</span><span class="p">()):</span>
    <span class="n">propagate</span><span class="o">.</span><span class="n">nominal</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;pycallgraph.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/example_pump_Parallelism_Tutorial_67_0.png" src="../_images/example_pump_Parallelism_Tutorial_67_0.png" />
</div>
</div>
<p>As shown, running this model is not particularly computationally expensive. As a result, the majority of the computational expense is not actually because of the simulation itself, but because of the way the model is simulated: - 0.03 of 0.13 s (23%) is spent re-initalizing the model at first so that the model object can be re-used without worrying about it being modified by any previous executions - 0.026 of 0.13 s (20%) is spent recording the model history - 0.062 of 0.13 s (47%) is spent
simulating the model This is mostly because the model itself is computationally inexpensive. However, it also shows how one might easily speed up simulation for optimization or large-n simulations–avoiding unnecessary re-initialization or tracking fewer model states. This can be done using the options for <code class="docutils literal notranslate"><span class="pre">track</span></code> (as mentioned above) and <code class="docutils literal notranslate"><span class="pre">protect</span></code>, which specifies whether the model used is re-instantiated for the simulation (True) or used directly (False).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../docs/Approach_Use-Cases.html" class="btn btn-neutral float-left" title="Defining Fault Sampling Approaches in fmdtools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../docs/Nominal_Approach_Use-Cases.html" class="btn btn-neutral float-right" title="Defining Nominal Approaches in fmdtools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>